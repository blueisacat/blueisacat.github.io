
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="梅尔菲斯的个人网站">
      
      
        <meta name="author" content="梅尔菲斯">
      
      
        <link rel="canonical" href="https://www.blueisacat.cn/documents/ClickHouse/ClickHouse%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E9%AB%98%E7%BA%A7/">
      
      
        <link rel="prev" href="../ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%88%9D%E7%BA%A7/">
      
      
        <link rel="next" href="../ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%A4%87%E4%BB%BD/">
      
      
      <link rel="icon" href="../../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>ClickHouse从入门到精通-高级 - Blue是只蓝色的猫</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#clickhouse-" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="Blue是只蓝色的猫" class="md-header__button md-logo" aria-label="Blue是只蓝色的猫" data-md-component="logo">
      
  <img src="../../../../favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Blue是只蓝色的猫
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ClickHouse从入门到精通-高级
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-blue"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Alibaba/Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%EF%BC%88%E9%BB%84%E5%B1%B1%E7%89%88%EF%BC%89/" class="md-tabs__link">
          
  
  
  Alibaba

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Article/%E6%94%B6%E8%97%8F%E5%A4%B9/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%82%96%E8%AE%BA/" class="md-tabs__link">
          
  
  
  Article

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%88%9D%E7%BA%A7/" class="md-tabs__link">
          
  
  
  ClickHouse

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Doris/Doris%E9%80%89%E5%9E%8B%E5%AF%B9%E6%AF%94/Doris%20vs%20ClickHouse/" class="md-tabs__link">
          
  
  
  Doris

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%881%2B2%EF%BC%89%EF%BC%9A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%A7%A3%E6%9E%90/" class="md-tabs__link">
          
  
  
  Flink

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Hadoop/Hadoop%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92/CDH%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90%E7%9A%84%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E5%92%8C%E8%A7%92%E8%89%B2%E9%85%8D%E7%BD%AE/" class="md-tabs__link">
          
  
  
  Hadoop

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Linux/Linux%E6%8C%87%E4%BB%A4/Linux%E6%8C%87%E4%BB%A4/" class="md-tabs__link">
          
  
  
  Linux

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Maven/Maven%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/Maven%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" class="md-tabs__link">
          
  
  
  Maven

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Blue是只蓝色的猫" class="md-nav__button md-logo" aria-label="Blue是只蓝色的猫" data-md-component="logo">
      
  <img src="../../../../favicon.ico" alt="logo">

    </a>
    Blue是只蓝色的猫
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Alibaba
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Alibaba
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Java开发手册
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            Java开发手册
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Alibaba/Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%EF%BC%88%E9%BB%84%E5%B1%B1%E7%89%88%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java开发手册（黄山版）
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Article
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Article
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    收藏夹
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            收藏夹
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Article/%E6%94%B6%E8%97%8F%E5%A4%B9/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%82%96%E8%AE%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    软件开发的四大悖论
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    ClickHouse
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            ClickHouse
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ClickHouse入门教程
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            ClickHouse入门教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E5%88%9D%E7%BA%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ClickHouse从入门到精通-初级
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ClickHouse从入门到精通-高级
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ClickHouse从入门到精通-高级
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-explain" class="md-nav__link">
    <span class="md-ellipsis">
      1 Explain 查看执行计划
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 Explain 查看执行计划">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 基本语法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-explain" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 新版本使用 EXPLAIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 老版本查看执行计划
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2 建表优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 建表优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.1 时间字段的类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.2 空值存储类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 分区和索引
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 表参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 写入和删除优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 常见配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.5 常见配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.1 CPU 资源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.2 内存资源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#253" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.3 存储
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      3 ClickHouse 语法优化规则
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 ClickHouse 语法优化规则">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 准备测试用表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-count" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 COUNT 优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 消除子查询重复字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 谓词下推
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 聚合计算外推
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 聚合函数消除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-order-by-key" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 删除重复的 order by key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38-limit-by-key" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 删除重复的 limit by key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-using-key" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 删除重复的 USING Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#310" class="md-nav__link">
    <span class="md-ellipsis">
      3.10 标量替换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    <span class="md-ellipsis">
      3.11 三元运算优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 查询优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 查询优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 单表查询
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 单表查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-prewhere-where" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.1 Prewhere 替代 where
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.2 数据采样
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.3 列裁剪与分区裁剪
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-orderby-wherelimit" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.4 orderby 结合 where、limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.5 避免构建虚拟列
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-uniqcombined-distinct" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.6 uniqCombined 替代 distinct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.7 使用物化视图
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.8 其他注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 多表关联
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 多表关联">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 准备表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-in-join" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 用 IN 代替 JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-join" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 大小表 JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 注意谓词下推（版本差异）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#425-global" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.5 分布式表使用 GLOBAL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#426" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.6 使用字典表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#427" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.7 提前过滤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5 数据一致性（重点）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 数据一致性（重点）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 准备测试表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-optimize" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 手动 OPTIMIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-group-by" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 通过 Group by 去重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-final" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 通过 FINAL 查询
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.4 通过 FINAL 查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541" class="md-nav__link">
    <span class="md-ellipsis">
      5.4.1 老版本测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542" class="md-nav__link">
    <span class="md-ellipsis">
      5.4.2 新版本测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6 物化视图
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 物化视图">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.1 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#611" class="md-nav__link">
    <span class="md-ellipsis">
      6.1.1 物化视图与普通视图的区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#612" class="md-nav__link">
    <span class="md-ellipsis">
      6.1.2 优缺点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#613" class="md-nav__link">
    <span class="md-ellipsis">
      6.1.3 基本语法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.1 准备测试用表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.2 创建物化视图
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.3 导入增量数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#634" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.4 导入历史数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-materializemysql" class="md-nav__link">
    <span class="md-ellipsis">
      7 MaterializeMySQL 引擎
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 MaterializeMySQL 引擎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.1 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#711" class="md-nav__link">
    <span class="md-ellipsis">
      7.1.1 特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#712" class="md-nav__link">
    <span class="md-ellipsis">
      7.1.2 使用细则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#721-mysql-binlog-gtid" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.1 MySQL 开启 binlog 和 GTID 模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.2 准备 MySQL 表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#723-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.3 开启 ClickHouse 物化引擎
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#724" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.4 创建复制管道
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#725" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.5 修改数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#726" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.6 删除数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#727" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.7 删除表
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8 常见问题排查
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 常见问题排查">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-ddl" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 分布式 DDL 某数据节点的副本不执行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 数据副本表和数据不一致
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83" class="md-nav__link">
    <span class="md-ellipsis">
      8.3 副本节点全量恢复
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-zk" class="md-nav__link">
    <span class="md-ellipsis">
      8.4 数据副本启动缺少 zk 表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85-zk-table-replicas" class="md-nav__link">
    <span class="md-ellipsis">
      8.5 ZK table replicas 数据未删除，导致重建表报错
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#86-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      8.6 Clickhouse 节点意外关闭
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#87" class="md-nav__link">
    <span class="md-ellipsis">
      8.7 其他问题参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%A4%87%E4%BB%BD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ClickHouse从入门到精通-监控与备份
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ClickHouse基础知识
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            ClickHouse基础知识
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ClickHouse%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/LSM%20Tree%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LSM Tree原理详解
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Doris
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Doris
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Doris选型对比
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Doris选型对比
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E9%80%89%E5%9E%8B%E5%AF%B9%E6%AF%94/Doris%20vs%20ClickHouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Doris vs ClickHouse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E9%80%89%E5%9E%8B%E5%AF%B9%E6%AF%94/Doris%203.x%20vs%20Doris%202.X/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Doris3.x vs Doris2.x
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Doris用户手册
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Doris用户手册
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1" id="__nav_4_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1 安装部署
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1">
            <span class="md-nav__icon md-icon"></span>
            1 安装部署
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1_1" id="__nav_4_2_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.1 源码编译
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            1.1 源码编译
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.1%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/1.1.1%20%E4%BD%BF%E7%94%A8%20Docker%20%E5%BC%80%E5%8F%91%E9%95%9C%E5%83%8F%E7%BC%96%E8%AF%91%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1.1 使用 Docker 开发镜像编译（推荐）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.1%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/1.1.2%20%E4%BD%BF%E7%94%A8%20LDB%20Toolchain%20%E7%BC%96%E8%AF%91%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1.2 使用 LDB Toolchain 编译（推荐）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.1%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/1.1.3%20Linux%20%E5%B9%B3%E5%8F%B0%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%AF%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1.3 Linux 平台直接编译
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.1%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/1.1.4%20Arm%20%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%BC%96%E8%AF%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1.4 Arm 平台上编译
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.1%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/1.1.5%20Windows%20%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%BC%96%E8%AF%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1.5 Windows 平台上编译
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.1%20%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/1.1.6%20%E5%9C%A8%20MacOS%20%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%BC%96%E8%AF%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1.6 在 MacOS 平台上编译
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1_2" id="__nav_4_2_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.2 集群部署
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            1.2 集群部署
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.1%20%E6%89%8B%E5%8A%A8%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.1 手动部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.2%20Docker%20%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.2 Docker 部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1_2_3" id="__nav_4_2_1_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.2.3 K8s 部署
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_2_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            1.2.3 K8s 部署
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.1%20%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.1 集群环境要求
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1_2_3_2" id="__nav_4_2_1_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.2.3.2 Compute storage coupled
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_4_2_1_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            1.2.3.2 Compute storage coupled
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.2%20Compute%20storage%20coupled/1.2.3.2.1%20%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.2.1 快速部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.2%20Compute%20storage%20coupled/1.2.3.2.2%20%E9%83%A8%E7%BD%B2%20Doris%20Operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.2.2 部署 Doris Operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.2%20Compute%20storage%20coupled/1.2.3.2.3%20%E9%85%8D%E7%BD%AE%20Doris%20%E9%9B%86%E7%BE%A4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.2.3 配置 Doris 集群
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.2%20Compute%20storage%20coupled/1.2.3.2.4%20%E9%9B%86%E7%BE%A4%E8%BF%90%E7%BB%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.2.4 集群运维
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1_2_3_3" id="__nav_4_2_1_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    1.2.3.3 Compute storage decoupled
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_4_2_1_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            1.2.3.3 Compute storage decoupled
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.3%20Compute%20storage%20decoupled/1.2.3.3.1%20%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.3.1 快速部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.3%20Compute%20storage%20decoupled/1.2.3.3.2%20%E9%83%A8%E7%BD%B2%20FoundationDB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.3.2 部署 FoundationDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.3%20Compute%20storage%20decoupled/1.2.3.3.3%20%E9%85%8D%E7%BD%AE%E9%83%A8%E7%BD%B2%20Metaservice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.3.3 配置部署 Metaservice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.3%20Compute%20storage%20decoupled/1.2.3.3.4%20%E9%85%8D%E7%BD%AE%E9%83%A8%E7%BD%B2%20FE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.3.4 配置部署 FE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.3%20K8s%20%E9%83%A8%E7%BD%B2/1.2.3.3%20Compute%20storage%20decoupled/1.2.3.3.5%20%E9%85%8D%E7%BD%AE%E9%83%A8%E7%BD%B2%E8%AE%A1%E7%AE%97%E7%BB%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.3.3.5 配置部署计算组
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/1%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/1.2%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/1.2.4%20Doris%20on%20AWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2.4 Doris on AWS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2 数据库连接
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            2 数据库连接
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/2%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/2.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.1 数据库连接
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/2%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/2.2%20%E5%9F%BA%E4%BA%8E%20Arrow%20Flight%20SQL%20%E7%9A%84%E9%AB%98%E9%80%9F%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E9%93%BE%E8%B7%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.2 基于 Arrow Flight SQL 的高速数据传输链路
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3 数据表设计
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            3 数据表设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.1%20%E6%A6%82%E8%A7%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1 概览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.2%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.2 数据类型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3_3" id="__nav_4_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.3 表索引
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            3.3 表索引
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.3%20%E8%A1%A8%E7%B4%A2%E5%BC%95/3.3.1%20%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3.1 索引概述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.3%20%E8%A1%A8%E7%B4%A2%E5%BC%95/3.3.2%20%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E4%B8%8E%E6%8E%92%E5%BA%8F%E9%94%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3.2 前缀索引与排序键
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.3%20%E8%A1%A8%E7%B4%A2%E5%BC%95/3.3.3%20%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3.3 倒排索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.3%20%E8%A1%A8%E7%B4%A2%E5%BC%95/3.3.4%20BloomFilter%20%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3.4 BloomFilter 索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.3%20%E8%A1%A8%E7%B4%A2%E5%BC%95/3.3.5%20N-Gram%20%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3.5 N-Gram 索引
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3_4" id="__nav_4_2_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.4 Tiered Storage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3_4">
            <span class="md-nav__icon md-icon"></span>
            3.4 Tiered Storage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.4%20Tiered%20Storage/3.4.1%20SSD%20%E5%92%8C%20HDD%20%E5%B1%82%E7%BA%A7%E5%AD%98%E5%82%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.4.1 SSD 和 HDD 层级存储
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.4%20Tiered%20Storage/3.4.2%20%E8%BF%9C%E7%A8%8B%E5%AD%98%E5%82%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.4.2 远程存储
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3_5" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3_5" id="__nav_4_2_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.5 数据模型
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            3.5 数据模型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.5%20%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/3.5.1%20%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5.1 模型概述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.5%20%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/3.5.2%20%E6%98%8E%E7%BB%86%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5.2 明细模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.5%20%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/3.5.3%20%E4%B8%BB%E9%94%AE%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5.3 主键模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.5%20%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/3.5.4%20%E8%81%9A%E5%90%88%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5.4 聚合模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.5%20%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/3.5.5%20%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5.5 使用注意
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.6%20%E8%A1%8C%E5%88%97%E6%B7%B7%E5%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.6 行列混存
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3_7" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3_7" id="__nav_4_2_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    3.7 数据划分
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3_7">
            <span class="md-nav__icon md-icon"></span>
            3.7 数据划分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.1%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.1 基本概念
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.2%20%E6%89%8B%E5%8A%A8%E5%88%86%E5%8C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.2 手动分区
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.3%20%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.3 动态分区
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.4%20%E8%87%AA%E5%8A%A8%E5%88%86%E5%8C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.4 自动分区
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.5%20%E6%89%8B%E5%8A%A8%E5%88%86%E6%A1%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.5 手动分桶
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.6%20%E8%87%AA%E5%8A%A8%E5%88%86%E6%A1%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.6 自动分桶
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.7%20%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86/3.7.7%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7.7 常见问题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.8%20Schema%20%E5%8F%98%E6%9B%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.8 Schema 变更
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.9%20%E8%87%AA%E5%A2%9E%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.9 自增列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/3%20%E6%95%B0%E6%8D%AE%E8%A1%A8%E8%AE%BE%E8%AE%A1/3.10%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E8%A1%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.10 数据库建表最佳实践
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4 数据操作
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            4 数据操作
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4_1" id="__nav_4_2_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.1 数据导入
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            4.1 数据导入
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.1%20%E5%AF%BC%E5%85%A5%E6%A6%82%E8%A7%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.1 导入概览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4_1_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4_1_2" id="__nav_4_2_4_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.1.2 导入方式
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_2_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            4.1.2 导入方式
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.2%20%E5%AF%BC%E5%85%A5%E6%96%B9%E5%BC%8F/4.1.2.1%20Stream%20Load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.2.1 Stream Load
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.2%20%E5%AF%BC%E5%85%A5%E6%96%B9%E5%BC%8F/4.1.2.2%20Broker%20Load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.2.2 Broker Load
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.2%20%E5%AF%BC%E5%85%A5%E6%96%B9%E5%BC%8F/4.1.2.3%20Routine%20Load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.2.3 Routine Load
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.2%20%E5%AF%BC%E5%85%A5%E6%96%B9%E5%BC%8F/4.1.2.4%20Insert%20Into/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.2.4 Insert Into
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.2%20%E5%AF%BC%E5%85%A5%E6%96%B9%E5%BC%8F/4.1.2.5%20MySQL%20Load/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.2.5 MySQL Load
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.2%20%E5%AF%BC%E5%85%A5%E6%96%B9%E5%BC%8F/4.1.2.6%20Group%20Commit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.2.6 Group Commit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.3%20%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.3 导入数据格式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.4%20%E9%94%99%E8%AF%AF%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.4 错误数据处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.5%20%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.5 数据转换
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.6%20%E5%AF%BC%E5%85%A5%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.6 导入高可用性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5/4.1.7%20%E4%BB%8E%E5%85%B6%E4%BB%96%20AP%20%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB%E6%95%B0%E6%8D%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1.7 从其他 AP 系统迁移数据
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4_2" id="__nav_4_2_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.2 数据导入
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            4.2 数据导入
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.2%20%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/4.2.1%20%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2.1 数据更新概述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.2%20%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/4.2.2%20%E4%B8%BB%E9%94%AE%E6%A8%A1%E5%9E%8B%E7%9A%84%20Update%20%E6%9B%B4%E6%96%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2.2 主键模型的 Update 更新
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.2%20%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/4.2.3%20%E4%B8%BB%E9%94%AE%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AF%BC%E5%85%A5%E6%9B%B4%E6%96%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2.3 主键模型的导入更新
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.2%20%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/4.2.4%20%E8%81%9A%E5%90%88%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AF%BC%E5%85%A5%E6%9B%B4%E6%96%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2.4 聚合模型的导入更新
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.2%20%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/4.2.5%20%E4%B8%BB%E9%94%AE%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%9B%B4%E6%96%B0%E4%BA%8B%E5%8A%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2.5 主键模型的更新事务
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4_3" id="__nav_4_2_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.3 数据删除
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            4.3 数据删除
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.3%20%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4/4.3.1%20Delete%20%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3.1 Delete 操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.3%20%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4/4.3.2%20%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3.2 批量删除
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.3%20%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4/4.3.3%20Truncate%20%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3.3 Truncate 操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.3%20%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4/4.3.4%20%E8%A1%A8%E5%8E%9F%E5%AD%90%E6%9B%BF%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3.4 表原子替换
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.3%20%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4/4.3.5%20%E4%B8%B4%E6%97%B6%E5%88%86%E5%8C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3.5 临时分区
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4_4" id="__nav_4_2_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    4.4  数据导出
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4_4">
            <span class="md-nav__icon md-icon"></span>
            4.4  数据导出
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.4%20%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA/4.4.1%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4.1 数据导出概述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.4%20%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA/4.4.2%20Export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4.2 Export
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.4%20%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA/4.4.3%20Select%20Into%20Outfile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4.3 Select Into Outfile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.4%20%20%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA/4.4.4%20MySQL%20Dump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4.4 MySQL Dump
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.5%20%E4%BD%9C%E4%B8%9A%E8%B0%83%E5%BA%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.5 作业调度
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/4%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/4.6%20%E4%BA%8B%E5%8A%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.6 事务
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_5" >
        
          
          <label class="md-nav__link" for="__nav_4_2_5" id="__nav_4_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5 数据查询
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_5">
            <span class="md-nav__icon md-icon"></span>
            5 数据查询
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.1%20MySQL%20%E5%85%BC%E5%AE%B9%E6%80%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.1 MySQL 兼容性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.2%20%E8%BF%9E%E6%8E%A5%EF%BC%88JOIN%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.2 连接（JOIN）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.3%20%E5%AD%90%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.3 子查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.4%20%E8%81%9A%E5%90%88%E5%A4%9A%E7%BB%B4%E5%88%86%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.4 聚合多维分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.5%20%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0%20%28%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.5 分析函数 (窗口函数）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.6%20%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88CTE%EF%BC%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.6 公用表表达式（CTE）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_5_7" >
        
          
          <label class="md-nav__link" for="__nav_4_2_5_7" id="__nav_4_2_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    5.7 自定义函数
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_5_7">
            <span class="md-nav__icon md-icon"></span>
            5.7 自定义函数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.7%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/5.7.1%20%E5%88%AB%E5%90%8D%E5%87%BD%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.7.1 别名函数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.7%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/5.7.2%20Java%20UDF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.7.2 Java UDF
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.8%20%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.8 复杂类型查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.9%20%E5%88%97%E8%BD%AC%E8%A1%8C%20%28Lateral%20View%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.9 列转行 (Lateral View)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/5%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/5.10%20%E5%8A%A0%E5%AF%86%E5%92%8C%E8%84%B1%E6%95%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.10 加密和脱敏
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6 查询加速
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            6 查询加速
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6_1" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6_1" id="__nav_4_2_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.1 物化视图
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6_1">
            <span class="md-nav__icon md-icon"></span>
            6.1 物化视图
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E6%A6%82%E8%A7%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.1 物化视图概览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.2%20%E5%90%8C%E6%AD%A5%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.2 同步物化视图
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6_1_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6_1_3" id="__nav_4_2_6_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.1.3 异步物化视图
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_2_6_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6_1_3">
            <span class="md-nav__icon md-icon"></span>
            6.1.3 异步物化视图
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3%20%E5%BC%82%E6%AD%A5%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3.1%20%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.3.1 原理介绍
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3%20%E5%BC%82%E6%AD%A5%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3.2%20%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.3.2 功能描述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3%20%E5%BC%82%E6%AD%A5%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3.3%20%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.3.3 使用与实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.1%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3%20%E5%BC%82%E6%AD%A5%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE/6.1.3.4%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.3.4 常见问题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.2%20%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.2 查询缓存
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.3%20%E9%AB%98%E5%B9%B6%E5%8F%91%E7%82%B9%E6%9F%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.3 高并发点查
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6_4" id="__nav_4_2_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.4 高效去重
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6_4">
            <span class="md-nav__icon md-icon"></span>
            6.4 高效去重
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.4%20%E9%AB%98%E6%95%88%E5%8E%BB%E9%87%8D/6.4.1%20BITMAP%20%E7%B2%BE%E5%87%86%E5%8E%BB%E9%87%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.1.4 BITMAP 精准去重
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.4%20%E9%AB%98%E6%95%88%E5%8E%BB%E9%87%8D/6.4.2%20HLL%20%E8%BF%91%E4%BC%BC%E5%8E%BB%E9%87%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.4.2 HLL 近似去重
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.5%20%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E5%99%A8%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.5 查询优化器介绍
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.6%20Pipeline%20%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.6 Pipeline 执行引擎
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.7%20%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.7 统计信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6_8" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6_8" id="__nav_4_2_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.8 查询调优原理与实践
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6_8">
            <span class="md-nav__icon md-icon"></span>
            6.8 查询调优原理与实践
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.1%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.1 查询调优概述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.2%20%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.2 查询性能分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6_8_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6_8_3" id="__nav_4_2_6_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    6.8.3 计划调优
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_2_6_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6_8_3">
            <span class="md-nav__icon md-icon"></span>
            6.8.3 计划调优
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.1%20%E4%BC%98%E5%8C%96%E8%A1%A8%20Schema%20%E8%AE%BE%E8%AE%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.1 优化表 Schema 设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.2%20%E4%BC%98%E5%8C%96%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%92%8C%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.2 优化索引设计和使用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.3%20%E4%BD%BF%E7%94%A8%20PrepareStatement%20%E5%8A%A0%E9%80%9F%E9%AB%98%E5%B9%B6%E5%8F%91%E7%82%B9%E6%9F%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.3 使用 PrepareStatement 加速高并发点查
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.4%20%E4%BD%BF%E7%94%A8%E5%88%86%E5%8C%BA%E8%A3%81%E5%89%AA%E4%BC%98%E5%8C%96%E6%89%AB%E8%A1%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.4 使用分区裁剪优化扫表
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.5%20%E4%BD%BF%E7%94%A8%E5%8D%95%E8%A1%A8%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E9%80%8F%E6%98%8E%E6%94%B9%E5%86%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.5 使用单表物化视图透明改写
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.6%20%E4%BD%BF%E7%94%A8%E5%A4%9A%E8%A1%A8%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E9%80%8F%E6%98%8E%E6%94%B9%E5%86%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.6 使用多表物化视图透明改写
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.7%20%E4%BD%BF%E7%94%A8%E5%88%97%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E4%BC%98%E5%8C%96%E8%AE%A1%E5%88%92/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.7 使用列统计信息优化计划
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.8%20%E4%BD%BF%E7%94%A8%20Colocate%20Group%20%E4%BC%98%E5%8C%96%20Join/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.8 使用 Colocate Group 优化 Join
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.9%20%E4%BD%BF%E7%94%A8%20Hint%20%E8%B0%83%E6%95%B4%20Join%20Shuffle%20%E6%96%B9%E5%BC%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.9 使用 Hint 调整 Join Shuffle 方式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.10%20%E4%BD%BF%E7%94%A8%20Hint%20%E6%8E%A7%E5%88%B6%E4%BB%A3%E4%BB%B7%E6%94%B9%E5%86%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.10 使用 Hint 控制代价改写
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.11%20%E4%BD%BF%E7%94%A8%20Leading%20Hint%20%E6%8E%A7%E5%88%B6%20Join%20%E9%A1%BA%E5%BA%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.11 使用 Leading Hint 控制 Join 顺序
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.12%20%E4%BD%BF%E7%94%A8%20SQL%20Cache%20%E5%8A%A0%E9%80%9F%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.12 使用 SQL Cache 加速查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.13%20%E4%BD%BF%E7%94%A8%20Runtime%20Filter%20%E9%AB%98%E9%98%B6%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.13 使用 Runtime Filter 高阶优化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.14%20%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.14 数据倾斜处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.3%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/6.8.3.15%20DML%20%E8%AE%A1%E5%88%92%E8%B0%83%E4%BC%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.3.15 DML 计划调优
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.4%20%E5%B8%B8%E8%A7%81%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.4 常见调优参数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.5%20Hint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.5 Hint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.6%20Runtime%20Filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.6 Runtime Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/6%20%E6%9F%A5%E8%AF%A2%E5%8A%A0%E9%80%9F/6.8%20%E6%9F%A5%E8%AF%A2%E8%B0%83%E4%BC%98%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/6.8.7%20TOPN%20%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.8.7 TOPN 查询优化
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_7" >
        
          
          <label class="md-nav__link" for="__nav_4_2_7" id="__nav_4_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7 湖仓一体
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_7">
            <span class="md-nav__icon md-icon"></span>
            7 湖仓一体
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.1%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.1 湖仓一体概述
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_7_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_7_2" id="__nav_4_2_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7.2 数据湖分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_7_2">
            <span class="md-nav__icon md-icon"></span>
            7.2 数据湖分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.1%20Hive%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.1 Hive Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.2%20Hudi%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.2 Hudi Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.3%20Iceberg%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.3 Iceberg Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.4%20Paimon%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.4 Paimon Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.5%20LakeSoul%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.5 LakeSoul Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.6%20BigQuery%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.6 BigQuery Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.7%20Delta%20Lake%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.7 Delta Lake Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.8%20Kudu%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.8 Kudu Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.9%20%E9%98%BF%E9%87%8C%E4%BA%91%20DLF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.9 阿里云 DLF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.10%20TPCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.10 TPCH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.2%20%E6%95%B0%E6%8D%AE%E6%B9%96%E5%88%86%E6%9E%90/7.2.11%20TPCDS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.2.11 TPCDS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_7_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_7_3" id="__nav_4_2_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7.3 数据湖构建
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_7_3">
            <span class="md-nav__icon md-icon"></span>
            7.3 数据湖构建
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.3%20%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%84%E5%BB%BA/7.3.1%20Hive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.3.1 Hive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.3%20%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%84%E5%BB%BA/7.3.2%20Iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.3.2 Iceberg
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_7_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_7_4" id="__nav_4_2_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    7.4 数据库分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_2_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_7_4">
            <span class="md-nav__icon md-icon"></span>
            7.4 数据库分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.1%20JDBC%20Catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.1 JDBC Catalog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.2%20MySQL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.2 MySQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.3%20PostgreSQL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.3 PostgreSQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.4%20Oracle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.4 Oracle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.5%20SQL%20Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.5 SQL Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.6%20IBM%20Db2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.6 IBM Db2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.7%20ClickHouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.7 ClickHouse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.8%20SAP%20HANA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.8 SAP HANA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.9%20OceanBase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.9 OceanBase
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.10%20Elasticsearch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.10 Elasticsearch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.4%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E6%9E%90/7.4.11%20%E9%98%BF%E9%87%8C%E4%BA%91%20MaxCompute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.4.11 阿里云 MaxCompute
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.5%20%E5%88%86%E6%9E%90%20S3%E3%80%81HDFS%20%E4%B8%8A%E7%9A%84%E6%96%87%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.5 分析 S3/HDFS 上的文件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.6%20%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.6 数据缓存
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.7%20%E5%85%83%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.7 元数据缓存
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.8%20%E5%BC%B9%E6%80%A7%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.8 弹性计算节点
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.9%20%E5%A4%96%E8%A1%A8%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.9 外表统计信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.10%20%E4%BA%91%E6%9C%8D%E5%8A%A1%E8%AE%A4%E8%AF%81%E6%8E%A5%E5%85%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.10 云服务认证接入
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/7%20%E6%B9%96%E4%BB%93%E4%B8%80%E4%BD%93/7.11%20SQL%20%E6%96%B9%E8%A8%80%E5%85%BC%E5%AE%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.11 SQL 方言兼容
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_8" >
        
          
          <label class="md-nav__link" for="__nav_4_2_8" id="__nav_4_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    8 存算分离
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_8">
            <span class="md-nav__icon md-icon"></span>
            8 存算分离
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.1%20%E6%A6%82%E8%A7%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.1 概览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.2%20Doris%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB%E6%A8%A1%E5%BC%8F%E9%83%A8%E7%BD%B2%E5%87%86%E5%A4%87/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.2 Doris 存算分离模式部署准备
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.3%20%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.3 编译部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.4%20%E7%AE%A1%E7%90%86%20Storage%20Vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.4 管理 Storage Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.5%20%E8%AE%A1%E7%AE%97%E7%BB%84%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.5 计算组操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.6%20%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.6 数据缓存
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Doris/Doris%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C/8%20%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/8.7%20Meta%20Service%20API%20%E5%8F%82%E8%80%83/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.7 Meta Service API 参考
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flink
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Flink
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flink基础入门
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Flink基础入门
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%881%2B2%EF%BC%89%EF%BC%9A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%A7%A3%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（1+2）：基础概念解析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%883%EF%BC%89%EF%BC%9A%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%92%8C%E5%BA%94%E7%94%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%81%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%BF%90%E8%A1%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（3）：开发环境搭建和应用的配置、部署及运行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%884%EF%BC%89%EF%BC%9ADataStream%20API%20%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（4）：DataStream API 编程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%885%EF%BC%89%EF%BC%9A%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（5）：客户端操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%886%EF%BC%89%EF%BC%9AFlink%20Time%20%26%20Window%20%E8%A7%A3%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（6）：Flink Time &amp; Window 解析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%887%EF%BC%89%EF%BC%9A%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%8F%8A%E5%AE%B9%E9%94%99%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（7）：状态管理及容错机制
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%888%EF%BC%89%EF%BC%9ATable%20API%20%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（8）：Table API 编程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/Apache%20Flink%20%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%EF%BC%889%EF%BC%89%EF%BC%9AFlink%20SQL%20%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 零基础入门（9）：Flink SQL 编程实践
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flink进阶教程
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Flink进阶教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%881%EF%BC%89%EF%BC%9ARuntime%20%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E5%89%96%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（1）：Runtime 核心机制剖析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%882%EF%BC%89%EF%BC%9ATime%20%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（2）：Time 深度解析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%883%EF%BC%89%EF%BC%9ACheckpoint%20%E7%9A%84%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（3）：Checkpoint 的应用实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%884%EF%BC%89%EF%BC%9AFlink%20on%20YarnK8s%20%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E5%8F%8A%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（4）：Flink on YarnK8s 原理剖析及实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%885%EF%BC%89%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BA%8F%E5%88%97%E5%8C%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（5）：数据类型和序列化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%886%EF%BC%89%EF%BC%9AFlink%20%E4%BD%9C%E4%B8%9A%E6%89%A7%E8%A1%8C%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（6）：Flink 作业执行深度解析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%887%EF%BC%89%EF%BC%9A%E7%BD%91%E7%BB%9C%E6%B5%81%E6%8E%A7%E5%8F%8A%E5%8F%8D%E5%8E%8B%E5%89%96%E6%9E%90/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（7）：网络流控及反压剖析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%888%EF%BC%89%EF%BC%9A%E8%AF%A6%E8%A7%A3%20Metrics%20%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E6%88%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（8）：详解 Metrics 原理与实战
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%889%EF%BC%89%EF%BC%9AFlink%20Connector%20%E5%BC%80%E5%8F%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（9）：Flink Connector 开发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/Apache%20Flink%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%8810%EF%BC%89%EF%BC%9AFlink%20State%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Apache Flink 进阶教程（10）：Flink State 最佳实践
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flink基础知识
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Flink基础知识
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%A6%82%E5%BF%B5%EF%BC%9A%E6%B5%81%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84At%20Most%20Once%E3%80%81At%20Least%20Once%E3%80%81Exactly%20Once/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    概念：流计算中的At Most Once、At Least Once、Exactly Once
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flink案例分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Flink案例分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/%E6%A1%88%E4%BE%8B%EF%BC%881%EF%BC%89%EF%BC%9A360%20%E6%94%BF%E4%BC%81%E5%AE%89%E5%85%A8%E9%9B%86%E5%9B%A2%E5%9F%BA%E4%BA%8E%20Flink%20%E7%9A%84%20PB%20%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%8D%B3%E5%B8%AD%E6%9F%A5%E8%AF%A2%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    案例（1）：360 政企安全集团基于 Flink 的 PB 级数据即席查询实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/%E6%A1%88%E4%BE%8B%EF%BC%882%EF%BC%89%EF%BC%9AFlink%20%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97%E5%9C%A8%E5%BE%AE%E5%8D%9A%E7%9A%84%E5%BA%94%E7%94%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    案例（2）：Flink 实时计算在微博的应用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/%E6%A1%88%E4%BE%8B%EF%BC%883%EF%BC%89%EF%BC%9AFlink%20%E5%9C%A8%E9%A1%BA%E4%B8%B0%E7%9A%84%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    案例（3）：Flink 在顺丰的应用实践
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flink选型对比
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Flink选型对比
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Flink/Flink%E9%80%89%E5%9E%8B%E5%AF%B9%E6%AF%94/%E9%80%89%E5%9E%8B%EF%BC%9AFlink%E3%80%81Storm%E3%80%81Spark%E5%AF%B9%E6%AF%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    选型：Flink、Storm、Spark对比
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hadoop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Hadoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hadoop集群规划
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Hadoop集群规划
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Hadoop/Hadoop%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92/CDH%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90%E7%9A%84%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E5%92%8C%E8%A7%92%E8%89%B2%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CDH官方推荐的集群节点和角色配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Hadoop/Hadoop%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92/CDH%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2%E5%92%8C%E8%8A%82%E7%82%B9%E6%95%B0%E8%A7%84%E5%88%92%E5%BB%BA%E8%AE%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CDH集群角色和节点数规划建议
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hadoop配置优化
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Hadoop配置优化
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Hadoop/Hadoop%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96/CDH%E8%B0%83%E4%BC%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CDH调优
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux指令
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Linux指令
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Linux%E6%8C%87%E4%BB%A4/Linux%E6%8C%87%E4%BB%A4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux指令
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Maven
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Maven
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Maven使用手册
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Maven使用手册
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Maven/Maven%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/Maven%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maven使用手册
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Maven插件使用
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Maven插件使用
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Maven/Maven%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8/%E4%BD%BF%E7%94%A8flatten-maven-plugin%E6%8F%92%E4%BB%B6%E7%AE%A1%E7%90%86%E7%89%88%E6%9C%AC%E5%8F%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用flatten-maven-plugin插件管理版本号
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Maven/Maven%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8/%E4%BD%BF%E7%94%A8maven-assembly-plugin%E6%8F%92%E4%BB%B6%E5%AE%9A%E5%88%B6%E5%8C%96%E6%89%93%E5%8C%85/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用maven-assembly-plugin插件定制化打包
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-explain" class="md-nav__link">
    <span class="md-ellipsis">
      1 Explain 查看执行计划
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 Explain 查看执行计划">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 基本语法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-explain" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 新版本使用 EXPLAIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 老版本查看执行计划
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2 建表优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 建表优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.1 时间字段的类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    <span class="md-ellipsis">
      2.1.2 空值存储类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 分区和索引
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 表参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 写入和删除优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 常见配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.5 常见配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251-cpu" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.1 CPU 资源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.2 内存资源
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#253" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.3 存储
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      3 ClickHouse 语法优化规则
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 ClickHouse 语法优化规则">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 准备测试用表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-count" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 COUNT 优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 消除子查询重复字段
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 谓词下推
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 聚合计算外推
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 聚合函数消除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-order-by-key" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 删除重复的 order by key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38-limit-by-key" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 删除重复的 limit by key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39-using-key" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 删除重复的 USING Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#310" class="md-nav__link">
    <span class="md-ellipsis">
      3.10 标量替换
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    <span class="md-ellipsis">
      3.11 三元运算优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 查询优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 查询优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 单表查询
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 单表查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-prewhere-where" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.1 Prewhere 替代 where
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.2 数据采样
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.3 列裁剪与分区裁剪
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-orderby-wherelimit" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.4 orderby 结合 where、limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.5 避免构建虚拟列
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-uniqcombined-distinct" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.6 uniqCombined 替代 distinct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.7 使用物化视图
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418" class="md-nav__link">
    <span class="md-ellipsis">
      4.1.8 其他注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 多表关联
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 多表关联">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 准备表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-in-join" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 用 IN 代替 JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-join" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 大小表 JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 注意谓词下推（版本差异）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#425-global" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.5 分布式表使用 GLOBAL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#426" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.6 使用字典表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#427" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.7 提前过滤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5 数据一致性（重点）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5 数据一致性（重点）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 准备测试表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-optimize" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 手动 OPTIMIZE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-group-by" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 通过 Group by 去重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-final" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 通过 FINAL 查询
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.4 通过 FINAL 查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541" class="md-nav__link">
    <span class="md-ellipsis">
      5.4.1 老版本测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542" class="md-nav__link">
    <span class="md-ellipsis">
      5.4.2 新版本测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6 物化视图
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 物化视图">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.1 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#611" class="md-nav__link">
    <span class="md-ellipsis">
      6.1.1 物化视图与普通视图的区别
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#612" class="md-nav__link">
    <span class="md-ellipsis">
      6.1.2 优缺点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#613" class="md-nav__link">
    <span class="md-ellipsis">
      6.1.3 基本语法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.1 准备测试用表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622" class="md-nav__link">
    <span class="md-ellipsis">
      6.2.2 创建物化视图
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.3 导入增量数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#634" class="md-nav__link">
    <span class="md-ellipsis">
      6.3.4 导入历史数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-materializemysql" class="md-nav__link">
    <span class="md-ellipsis">
      7 MaterializeMySQL 引擎
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7 MaterializeMySQL 引擎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 概述
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.1 概述">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#711" class="md-nav__link">
    <span class="md-ellipsis">
      7.1.1 特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#712" class="md-nav__link">
    <span class="md-ellipsis">
      7.1.2 使用细则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 案例实操
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2 案例实操">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#721-mysql-binlog-gtid" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.1 MySQL 开启 binlog 和 GTID 模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.2 准备 MySQL 表和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#723-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.3 开启 ClickHouse 物化引擎
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#724" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.4 创建复制管道
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#725" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.5 修改数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#726" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.6 删除数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#727" class="md-nav__link">
    <span class="md-ellipsis">
      7.2.7 删除表
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8 常见问题排查
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 常见问题排查">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-ddl" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 分布式 DDL 某数据节点的副本不执行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 数据副本表和数据不一致
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83" class="md-nav__link">
    <span class="md-ellipsis">
      8.3 副本节点全量恢复
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-zk" class="md-nav__link">
    <span class="md-ellipsis">
      8.4 数据副本启动缺少 zk 表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85-zk-table-replicas" class="md-nav__link">
    <span class="md-ellipsis">
      8.5 ZK table replicas 数据未删除，导致重建表报错
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#86-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      8.6 Clickhouse 节点意外关闭
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#87" class="md-nav__link">
    <span class="md-ellipsis">
      8.7 其他问题参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="clickhouse-">ClickHouse从入门到精通-高级<a class="headerlink" href="#clickhouse-" title="Permanent link">&para;</a></h1>
<h2 id="1-explain">1 Explain 查看执行计划<a class="headerlink" href="#1-explain" title="Permanent link">&para;</a></h2>
<p>在 <code>clickhouse 20.6</code> 版本之前要查看 <code>SQL</code> 语句的执行计划需要设置日志级别为 <code>trace</code> 才能可以看到，并且只能真正执行 <code>sql</code> ，在执行日志里面查看。在 <code>20.6</code> 版本引入了原生的执行计划的语法。在 <code>20.6.3</code> 版本成为正式版本的功能。</p>
<p>本文档基于目前较新稳定版 <code>21.7.3.14</code> 。</p>
<h3 id="11">1.1 基本语法<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="p">[</span><span class="n">AST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PLAN</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PIPELINE</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">setting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="p">...]</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="n">FORMAT</span><span class="w"> </span><span class="p">...]</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>
<p><code>PLAN</code> ：用于查看执行计划，默认值。</p>
<ul>
<li>
<p><code>header</code> 打印计划中各个步骤的 <code>head</code> 说明，默认关闭，默认值 <code>0</code> ；</p>
</li>
<li>
<p><code>description</code> 打印计划中各个步骤的描述，默认开启，默认值 <code>1</code> ；</p>
</li>
<li>
<p><code>actions</code> 打印计划中各个步骤的详细信息，默认关闭，默认值 <code>0</code> 。</p>
</li>
</ul>
</li>
<li>
<p><code>AST</code> ：用于查看语法树；</p>
</li>
<li>
<p><code>SYNTAX</code> ：用于优化语法；</p>
</li>
<li>
<p><code>PIPELINE</code> ：用于查看 <code>PIPELINE</code> 计划。</p>
<ul>
<li>
<p><code>header</code> 打印计划中各个步骤的 <code>head</code> 说明，默认关闭；</p>
</li>
<li>
<p><code>graph</code> 用 <code>DOT</code> 图形语言描述管道图，默认关闭，需要查看相关的图形需要配合 <code>graphviz</code> 查看；</p>
</li>
<li>
<p><code>actions</code> 如果开启了 <code>graph</code> ，紧凑打印打，默认开启。</p>
</li>
</ul>
</li>
</ul>
<p>注： <code>PLAN</code> 和 <code>PIPELINE</code> 还可以进行额外的显示设置，如上参数所示。</p>
<h3 id="12">1.2 案例实操<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<h4 id="121-explain">1.2.1 新版本使用 EXPLAIN<a class="headerlink" href="#121-explain" title="Permanent link">&para;</a></h4>
<p>可以再安装一个 <code>20.6</code> 以上版本，或者直接在官网的在线 <code>demo</code> ，选择高版本进行测试。官网在线测试链接：<a href="https://play.clickhouse.tech/?file=welcome">https://play.clickhouse.tech/?file=welcome</a></p>
<ol>
<li>
<p>查看 <code>PLAIN</code></p>
<p>简单查询</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><span class="k">explain</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">arrayJoin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="k">null</span><span class="p">,</span><span class="k">null</span><span class="p">]);</span>
</span></code></pre></div></td></tr></table></div>
<p>复杂 <code>SQL</code> 的执行计划</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">database</span><span class="p">,</span><span class="k">table</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="n">parts</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;datasets&#39;</span><span class="p">,</span><span class="s1">&#39;system&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">database</span><span class="p">,</span><span class="k">table</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">database</span><span class="p">,</span><span class="n">cnt</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">database</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>打开全部的参数的执行计划</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">actions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="n">numbers</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p><code>AST</code> 语法树</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">AST</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">system</span><span class="p">.</span><span class="n">numbers</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p><code>SYNTAX</code> 语法优化</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><span class="o">#</span><span class="err">先做一次查询</span><span class="w"> </span>
</span><span id="__span-5-2"><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;atguigu&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-3"><span class="o">#</span><span class="err">查看语法优化</span><span class="w"> </span>
</span><span id="__span-5-4"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;atguigu&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-5"><span class="o">#</span><span class="err">开启三元运算符优化</span><span class="w"> </span>
</span><span id="__span-5-6"><span class="k">SET</span><span class="w"> </span><span class="n">optimize_if_chain_to_multiif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-5-7"><span class="o">#</span><span class="err">再次查看语法优化</span><span class="w"> </span>
</span><span id="__span-5-8"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;atguigu&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-5-9"><span class="o">#</span><span class="err">返回优化后的语句</span><span class="w"> </span>
</span><span id="__span-5-10"><span class="k">SELECT</span><span class="w"> </span><span class="n">multiIf</span><span class="p">(</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;hello\&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;world\&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;xyz\&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>查看 <code>PIPELINE</code></p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">PIPELINE</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="nb">number</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers_mt</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-6-2"><span class="o">#</span><span class="err">打开其他参数</span><span class="w"> </span>
</span><span id="__span-6-3"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">PIPELINE</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="nb">number</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers_mt</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nb">number</span><span class="o">%</span><span class="mi">20</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="122">1.2.2 老版本查看执行计划<a class="headerlink" href="#122" title="Permanent link">&para;</a></h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1">clickhouse-client<span class="w"> </span>-h<span class="w"> </span>主机名<span class="w"> </span>--send_logs_level<span class="o">=</span>trace<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;sql&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span></code></pre></div></td></tr></table></div>
<p>其中， <code>send_logs_level</code> 参数指定日志等级为 <code>trace</code> ， <code>&lt;&lt;&lt;</code> 将 <code>SQL</code> 语句重定向至 <code>clickhouse-client</code> 进行查询， <code>&gt; /dev/null</code> 将查询结果重定向到空设备吞掉，以便观察日志。</p>
<p>注意：</p>
<ol>
<li>
<p>通过将 <code>ClickHouse</code> 的服务日志，设置到 <code>DEBUG</code> 或者 <code>TRACE</code> 级别，才可以变相实现 <code>EXPLAIN</code> 查询的作用。</p>
</li>
<li>
<p>需要真正的执行 <code>SQL</code> 查询， <code>CH</code> 才能打印计划日志，所以如果表的数据量很大，最好借助 <code>LIMIT</code> 子句，减小查询返回的数据量。</p>
</li>
</ol>
<h2 id="2">2 建表优化<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 数据类型<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<h4 id="211">2.1.1 时间字段的类型<a class="headerlink" href="#211" title="Permanent link">&para;</a></h4>
<p>建表时能用数值型或日期时间型表示的字段就不要用字符串，全 <code>String</code> 类型在以 <code>Hive</code> 为中心的数仓建设中常见，但 <code>ClickHouse</code> 环境不应受此影响。</p>
<p>虽然 <code>ClickHouse</code> 底层将 <code>DateTime</code> 存储为时间戳 <code>Long</code> 类型，但不建议存储 <code>Long</code> 类型，因为 <code>DateTime</code> 不需要经过函数转换处理，执行效率高、可读性好。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_type2</span><span class="p">(</span>
</span><span id="__span-8-2"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UInt32</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-8-3"><span class="w">    </span><span class="n">sku_id</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-8-4"><span class="w">    </span><span class="n">total_amount</span><span class="w"> </span><span class="nb">Decimal</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-8-5"><span class="w">    </span><span class="n">create_time</span><span class="w"> </span><span class="n">Int32</span>
</span><span id="__span-8-6"><span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="n">ReplacingMergeTree</span><span class="p">(</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-8-7"><span class="w">    </span><span class="n">partition</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">toYYYYMMDD</span><span class="p">(</span><span class="n">toDate</span><span class="p">(</span><span class="n">create_time</span><span class="p">))</span><span class="w"> </span><span class="err">–</span><span class="o">-</span><span class="err">需要转换一次，否则报错</span><span class="w"> </span>
</span><span id="__span-8-8"><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-8-9"><span class="w">    </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">sku_id</span><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="212">2.1.2 空值存储类型<a class="headerlink" href="#212" title="Permanent link">&para;</a></h4>
<p>官方已经指出 <code>Nullable</code> 类型几乎总是会拖累性能，因为存储 <code>Nullable</code> 列时需要创建一个额外的文件来存储 <code>NULL</code> 的标记，并且 <code>Nullable</code> 列无法被索引。因此除非极特殊情况，应直接使用字段默认值表示空，或者自行指定一个在业务中无意义的值（例如用 <code>-1</code> 表示没有商品 <code>ID</code> ）。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t_null</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nb">Int8</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">Nullable</span><span class="p">(</span><span class="nb">Int8</span><span class="p">))</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="n">TinyLog</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-9-2"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t_null</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-9-3"><span class="k">SELECT</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_null</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>查看存储的文件：（没有权限就用 <code>root</code> 用户）</p>
<p><img alt="" src="../../../../assets/images/ClickHouse/ClickHouse%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E9%AB%98%E7%BA%A7_image_0.png" /></p>
<p>官网说明：<a href="https://clickhouse.tech/docs/zh/sql-reference/data-types/nullable/">https://clickhouse.tech/docs/zh/sql-reference/data-types/nullable/</a></p>
<h3 id="22">2.2 分区和索引<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<p>分区粒度根据业务特点决定，不宜过粗或过细。一般选择按天分区，也可以指定为 <code>Tuple()</code> ，以单表一亿数据为例，分区大小控制在 <code>10-30</code> 个为最佳。</p>
<p>必须指定索引列， <code>ClickHouse</code> 中的索引列即排序列，通过 <code>order by</code> 指定，一般在查询条件中经常被用来充当筛选条件的属性被纳入进来；可以是单一维度，也可以是组合维度的索引；通常需要满足高级列在前、查询频率大的在前原则；还有基数特别大的不适合做索引列，如用户表的 <code>userid</code> 字段；通常筛选后的数据满足在百万以内为最佳。</p>
<p>比如官方案例的 <code>hits_v1</code> 表：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span>
</span><span id="__span-10-2"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<p><code>visits_v1</code> 表：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">StartDate</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-11-2"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">StartDate</span><span class="p">,</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">),</span><span class="w"> </span><span class="n">VisitID</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="23">2.3 表参数<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<p><code>Index_granularity</code> 是用来控制索引粒度的，默认是 <code>8192</code> ，如非必须不建议调整。</p>
<p>如果表中不是必须保留全量历史数据，建议指定 <code>TTL</code> （生存时间值），可以免去手动过期历史数据的麻烦， <code>TTL</code> 也可以通过 <code>alter table</code> 语句随时修改。（参考基础文档 <code>4.4.5</code> 数据 <code>TTL</code> ）</p>
<h3 id="24">2.4 写入和删除优化<a class="headerlink" href="#24" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>尽量不要执行单条或小批量删除和插入操作，这样会产生小分区文件，给后台 <code>Merge</code> 任务带来巨大压力</p>
</li>
<li>
<p>不要一次写入太多分区，或数据写入太快，数据写入太快会导致 <code>Merge</code> 速度跟不上而报错，一般建议每秒钟发起 <code>2-3</code> 次写入操作，每次操作写入 <code>2w~5w</code> 条数据（依服务器性能而定）</p>
</li>
</ol>
<p>写入过快报错，报错信息：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><span class="m">1</span>.<span class="w"> </span>Code:<span class="w"> </span><span class="m">252</span>,<span class="w"> </span>e.displayText<span class="o">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DB::Exception:<span class="w"> </span>Too<span class="w"> </span>many<span class="w"> </span>parts<span class="o">(</span><span class="m">304</span><span class="o">)</span>.<span class="w"> </span>Merges<span class="w"> </span>are<span class="w"> </span>processing<span class="w"> </span>significantly<span class="w"> </span>slower<span class="w"> </span>than<span class="w"> </span>inserts<span class="w"> </span>
</span><span id="__span-12-2"><span class="m">2</span>.<span class="w"> </span>Code:<span class="w"> </span><span class="m">241</span>,<span class="w"> </span>e.displayText<span class="o">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DB::Exception:<span class="w"> </span>Memory<span class="w"> </span>limit<span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span>query<span class="o">)</span><span class="w"> </span>exceeded:would<span class="w"> </span>use<span class="w"> </span><span class="m">9</span>.37<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span>attempt<span class="w"> </span>to<span class="w"> </span>allocate<span class="w"> </span>chunk<span class="w"> </span>of<span class="w"> </span><span class="m">301989888</span><span class="w"> </span>bytes<span class="o">)</span>,<span class="w"> </span>maximum:<span class="w"> </span><span class="m">9</span>.31<span class="w"> </span>GiB
</span></code></pre></div></td></tr></table></div>
<p>处理方式：</p>
<p><code>Too many parts</code> 使用 <code>WAL</code> 预写日志，提高写入性能。</p>
<p><code>in_memory_parts_enable_wal</code> 默认为 <code>true</code></p>
<p>在服务器内存充裕的情况下增加内存配额，一般通过 <code>max_memory_usage</code> 来实现</p>
<p>在服务器内存不充裕的情况下，建议将超出部分内容分配到系统硬盘上，但会降低执行速度，一般通过 <code>max_bytes_before_external_group_by</code> 、 <code>max_bytes_before_external_sort</code> 参数来实现。</p>
<h3 id="25">2.5 常见配置<a class="headerlink" href="#25" title="Permanent link">&para;</a></h3>
<p>配置项主要在 <code>config.xml</code> 或 <code>users.xml</code> 中，基本上都在 <code>users.xml</code> 里</p>
<ul>
<li>
<p><code>config.xml</code> 的配置项</p>
<p><a href="https://clickhouse.tech/docs/en/operations/server-configuration-parameters/settings/">https://clickhouse.tech/docs/en/operations/server-configuration-parameters/settings/</a></p>
</li>
<li>
<p><code>users.xml</code> 的配置项</p>
<p><a href="https://clickhouse.tech/docs/en/operations/settings/settings/">https://clickhouse.tech/docs/en/operations/settings/settings/</a></p>
</li>
</ul>
<h4 id="251-cpu">2.5.1 CPU 资源<a class="headerlink" href="#251-cpu" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../../../../assets/images/ClickHouse/ClickHouse%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E9%AB%98%E7%BA%A7_image_1.png" /></p>
<h4 id="252">2.5.2 内存资源<a class="headerlink" href="#252" title="Permanent link">&para;</a></h4>
<p><img alt="" src="../../../../assets/images/ClickHouse/ClickHouse%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E9%AB%98%E7%BA%A7_image_2.png" /></p>
<h4 id="253">2.5.3 存储<a class="headerlink" href="#253" title="Permanent link">&para;</a></h4>
<p><code>ClickHouse</code> 不支持设置多数据目录，为了提升数据 <code>io</code> 性能，可以挂载虚拟券组，一个券组绑定多块物理磁盘提升读写性能，多数据查询场景 <code>SSD</code> 会比普通机械硬盘快 <code>2-3</code> 倍。</p>
<h2 id="3-clickhouse">3 ClickHouse 语法优化规则<a class="headerlink" href="#3-clickhouse" title="Permanent link">&para;</a></h2>
<p><code>ClickHouse</code> 的 <code>SQL</code> 优化规则是基于 <code>RBO(Rule Based Optimization)</code> ，下面是一些优化规则</p>
<h3 id="31">3.1 准备测试用表<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>上传官方的数据集</p>
<p>将 <code>visits_v1.tar</code> 和 <code>hits_v1.tar</code> 上传到虚拟机，解压到 <code>clickhouse</code> 数据路径下</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><span class="c1">#解压到 clickhouse 数据路径 </span>
</span><span id="__span-13-2">sudo<span class="w"> </span>tar<span class="w"> </span>-xvf<span class="w"> </span>hits_v1.tar<span class="w"> </span>-C<span class="w"> </span>/var/lib/clickhouse<span class="w"> </span>
</span><span id="__span-13-3">sudo<span class="w"> </span>tar<span class="w"> </span>-xvf<span class="w"> </span>visits_v1.tar<span class="w"> </span>-C<span class="w"> </span>/var/lib/clickhouse<span class="w"> </span>
</span><span id="__span-13-4"><span class="c1">#修改所属用户 </span>
</span><span id="__span-13-5">sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>clickhouse:clickhouse<span class="w"> </span>/var/lib/clickhouse/data/datasets<span class="w"> </span>
</span><span id="__span-13-6">sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>clickhouse:clickhouse<span class="w"> </span>/var/lib/clickhouse/metadata/datasets
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>重启 <code>clickhouse-server</code></p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1">sudo<span class="w"> </span>clickhouse<span class="w"> </span>restart
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>执行查询</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1">clickhouse-client<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;SELECT COUNT(*) FROM datasets.hits_v1&quot;</span>
</span><span id="__span-15-2">clickhouse-client<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;SELECT COUNT(*) FROM datasets.visits_v1&quot;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>注意：官方的 <code>tar</code> 包，包含了建库、建表语句、数据内容，这种方式不需要手动建库、建表，最方便。</p>
<p><code>hits_v1</code> 表有 <code>130</code> 多个字段， <code>880</code> 多万条数据</p>
<p><code>visits_v1</code> 表有 <code>180</code> 多个字段， <code>160</code> 多万条数据</p>
<h3 id="32-count">3.2 COUNT 优化<a class="headerlink" href="#32-count" title="Permanent link">&para;</a></h3>
<p>在调用 <code>count</code> 函数时，如果使用的是 <code>count()</code> 或者 <code>count(*)</code> ，且没有 <code>where</code> 条件，则会直接使用 <code>system.tables</code> 的 <code>total_rows</code> ，例如：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="k">FROM</span><span class="w"> </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-16-2"><span class="k">Union</span><span class="w"> </span>
</span><span id="__span-16-3"><span class="w">    </span><span class="n">Expression</span><span class="w"> </span><span class="p">(</span><span class="n">Projection</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-16-4"><span class="w">        </span><span class="n">Expression</span><span class="w"> </span><span class="p">(</span><span class="k">Before</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">SELECT</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-16-5"><span class="w">            </span><span class="n">MergingAggregated</span><span class="w"> </span>
</span><span id="__span-16-6"><span class="w">                </span><span class="n">ReadNothing</span><span class="w"> </span><span class="p">(</span><span class="n">Optimized</span><span class="w"> </span><span class="n">trivial</span><span class="w"> </span><span class="k">count</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>注意 <code>Optimized trivial count</code> ，这是对 <code>count</code> 的优化。</p>
<p>如果 <code>count</code> 具体的列字段，则不会使用此项优化：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">CounterID</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-17-2"><span class="k">Union</span><span class="w"> </span>
</span><span id="__span-17-3"><span class="w">    </span><span class="n">Expression</span><span class="w"> </span><span class="p">(</span><span class="n">Projection</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-17-4"><span class="w">        </span><span class="n">Expression</span><span class="w"> </span><span class="p">(</span><span class="k">Before</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">SELECT</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-17-5"><span class="w">            </span><span class="n">Aggregating</span><span class="w"> </span>
</span><span id="__span-17-6"><span class="w">                </span><span class="n">Expression</span><span class="w"> </span><span class="p">(</span><span class="k">Before</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-17-7"><span class="w">                    </span><span class="n">ReadFromStorage</span><span class="w"> </span><span class="p">(</span><span class="k">Read</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">MergeTree</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="33">3.3 消除子查询重复字段<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>下面语句子查询中有两个重复的 <code>id</code> 字段，会被去重：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-18-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-18-3"><span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">UserID</span><span class="p">,</span><span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">VisitID</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-18-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-18-5"><span class="w">        </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
</span><span id="__span-18-6"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-18-7"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-18-8"><span class="w">            </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">HaHa</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span>
</span><span id="__span-18-9"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-18-10"><span class="w">            </span><span class="n">visits_v1</span>
</span><span id="__span-18-11"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
</span><span id="__span-18-12"><span class="w">    </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-18-13"><span class="w">    </span><span class="k">limit</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-18-14">
</span><span id="__span-18-15"><span class="o">#</span><span class="err">返回优化语句：</span><span class="w"> </span>
</span><span id="__span-18-16"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-18-17"><span class="w">    </span><span class="n">UserID</span><span class="p">,</span><span class="n">VisitID</span><span class="p">,</span><span class="w"> </span><span class="n">URL</span><span class="p">,</span><span class="w">  </span><span class="n">b</span><span class="p">.</span><span class="n">UserID</span>
</span><span id="__span-18-18"><span class="k">FROM</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
</span><span id="__span-18-19"><span class="k">ALL</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
</span><span id="__span-18-20"><span class="p">(</span><span class="w"> </span>
</span><span id="__span-18-21"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-18-22"><span class="w">        </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span>
</span><span id="__span-18-23"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-18-24"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-18-25"><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
</span><span id="__span-18-26"><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-18-27"><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="34">3.4 谓词下推<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>当 <code>group by</code> 有 <code>having</code> 子句，但是没有 <code>with cube</code> 、 <code>with rollup</code> 或者 <code>with totals</code> 修饰的时候， <code>having</code> 过滤会下推到 <code>where</code> 提前过滤。例如下面的查询， <code>HAVING name</code> 变成了 <code>WHERE name</code> ，在 <code>group by</code> 之前过滤：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;8585742290196126178&#39;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-19-2"><span class="o">#</span><span class="err">返回优化语句</span><span class="w"> </span>
</span><span id="__span-19-3"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-19-4"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-19-5"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-19-6"><span class="w">    </span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-19-7"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-19-8"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span><span class="w"> </span>
</span><span id="__span-19-9"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">UserID</span>
</span></code></pre></div></td></tr></table></div>
<p>子查询也支持谓词下推：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-20-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-20-3"><span class="w">        </span><span class="o">*</span><span class="w"> </span>
</span><span id="__span-20-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-20-5"><span class="w">    </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-20-6"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-20-7"><span class="w">            </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-20-8"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-20-9"><span class="w">            </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-20-10"><span class="w">    </span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-20-11"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-20-12"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;8585742290196126178&#39;</span><span class="w"> </span>
</span><span id="__span-20-13">
</span><span id="__span-20-14"><span class="o">#</span><span class="err">返回优化后的语句</span><span class="w"> </span>
</span><span id="__span-20-15"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-20-16"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-20-17"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-20-18"><span class="p">(</span><span class="w"> </span>
</span><span id="__span-20-19"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-20-20"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-20-21"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-20-22"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-20-23"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-20-24"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span>
</span><span id="__span-20-25"><span class="p">)</span><span class="w"> </span>
</span><span id="__span-20-26"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-20-27"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span>
</span></code></pre></div></td></tr></table></div>
<p>再来一个复杂例子：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-21-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-3"><span class="w">        </span><span class="o">*</span><span class="w"> </span>
</span><span id="__span-21-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-5"><span class="w">    </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-21-6"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-7"><span class="w">            </span><span class="o">*</span><span class="w"> </span>
</span><span id="__span-21-8"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-9"><span class="w">        </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-21-10"><span class="w">            </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-11"><span class="w">                </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-12"><span class="w">            </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-13"><span class="w">                </span><span class="n">visits_v1</span>
</span><span id="__span-21-14"><span class="w">        </span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-21-15"><span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
</span><span id="__span-21-16"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-17"><span class="w">            </span><span class="o">*</span>
</span><span id="__span-21-18"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-19"><span class="w">        </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-21-20"><span class="w">            </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-21"><span class="w">                </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-22"><span class="w">            </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-23"><span class="w">                </span><span class="n">visits_v1</span>
</span><span id="__span-21-24"><span class="w">        </span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-21-25"><span class="w">    </span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-21-26"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-21-27"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;8585742290196126178&#39;</span><span class="w"> </span>
</span><span id="__span-21-28">
</span><span id="__span-21-29"><span class="o">#</span><span class="err">返回优化后的语句</span><span class="w"> </span>
</span><span id="__span-21-30"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-31"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-32"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-33"><span class="p">(</span><span class="w"> </span>
</span><span id="__span-21-34"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-35"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-36"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-37"><span class="w">    </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-21-38"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-39"><span class="w">            </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-40"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-41"><span class="w">            </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-21-42"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-21-43"><span class="w">            </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span>
</span><span id="__span-21-44"><span class="w">    </span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-21-45"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-21-46"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span><span class="w"> </span>
</span><span id="__span-21-47"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span>
</span><span id="__span-21-48"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-49"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-50"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-51"><span class="w">    </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-21-52"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-21-53"><span class="w">            </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-21-54"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-21-55"><span class="w">            </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-21-56"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-21-57"><span class="w">            </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span>
</span><span id="__span-21-58"><span class="w">    </span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-21-59"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-21-60"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span>
</span><span id="__span-21-61"><span class="p">)</span><span class="w"> </span>
</span><span id="__span-21-62"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-21-63"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;8585742290196126178\&#39;</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="35">3.5 聚合计算外推<a class="headerlink" href="#35" title="Permanent link">&para;</a></h3>
<p>聚合函数内的计算，会外推，例如：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-22-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-22-3"><span class="w">        </span><span class="k">sum</span><span class="p">(</span><span class="n">UserID</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-22-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-22-5"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-22-6">
</span><span id="__span-22-7"><span class="o">#</span><span class="err">返回优化后的语句</span><span class="w"> </span>
</span><span id="__span-22-8"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-22-9"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-22-10"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-22-11"><span class="w">    </span><span class="n">visits_v1</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="36">3.6 聚合函数消除<a class="headerlink" href="#36" title="Permanent link">&para;</a></h3>
<p>如果对聚合键，也就是 <code>group by key</code> 使用 <code>min</code> 、 <code>max</code> 、 <code>any</code> 聚合函数，则将函数消除，例如：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-23-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-23-3"><span class="w">        </span><span class="k">sum</span><span class="p">(</span><span class="n">UserID</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="k">max</span><span class="p">(</span><span class="n">VisitID</span><span class="p">),</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-23-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-23-5"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-23-6"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-23-7"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-23-8">
</span><span id="__span-23-9"><span class="o">#</span><span class="err">返回优化后的语句</span>
</span><span id="__span-23-10"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-23-11"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">VisitID</span><span class="p">),</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-23-12"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-23-13"><span class="w">    </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-23-14"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-23-15"><span class="w">    </span><span class="n">UserID</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="37-order-by-key">3.7 删除重复的 order by key<a class="headerlink" href="#37-order-by-key" title="Permanent link">&para;</a></h3>
<p>例如下面的语句，重复的聚合键 <code>id</code> 字段会被去重：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-24-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-24-3"><span class="w">        </span><span class="o">*</span><span class="w"> </span>
</span><span id="__span-24-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-24-5"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-24-6"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-24-7"><span class="w">        </span><span class="n">UserID</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span><span class="k">ASC</span><span class="w"> </span>
</span><span id="__span-24-8">
</span><span id="__span-24-9"><span class="o">#</span><span class="err">返回优化后的语句：</span><span class="w"> </span>
</span><span id="__span-24-10"><span class="k">select</span><span class="w"> </span>
</span><span id="__span-24-11"><span class="w">    </span><span class="err">……</span><span class="w"> </span>
</span><span id="__span-24-12"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-24-13"><span class="w">    </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-24-14"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-24-15"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span><span class="k">ASC</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="38-limit-by-key">3.8 删除重复的 limit by key<a class="headerlink" href="#38-limit-by-key" title="Permanent link">&para;</a></h3>
<p>例如下面的语句，重复声明的 <code>name</code> 字段会被去重：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-25-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-25-3"><span class="w">        </span><span class="o">*</span><span class="w"> </span>
</span><span id="__span-25-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-25-5"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span>
</span><span id="__span-25-6"><span class="w">    </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">VisitID</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span>
</span><span id="__span-25-7">
</span><span id="__span-25-8"><span class="o">#</span><span class="err">返回优化后的语句：</span><span class="w"> </span>
</span><span id="__span-25-9"><span class="k">select</span>
</span><span id="__span-25-10"><span class="w">    </span><span class="err">……</span><span class="w"> </span>
</span><span id="__span-25-11"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-25-12"><span class="w">    </span><span class="n">visits_v1</span>
</span><span id="__span-25-13"><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">VisitID</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="39-using-key">3.9 删除重复的 USING Key<a class="headerlink" href="#39-using-key" title="Permanent link">&para;</a></h3>
<p>例如下面的语句，重复的关联键 <code>id</code> 字段会被去重：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-26-2"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-26-3"><span class="w">        </span><span class="n">a</span><span class="p">.</span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">VisitID</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">UserID</span>
</span><span id="__span-26-4"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-26-5"><span class="w">        </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
</span><span id="__span-26-6"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
</span><span id="__span-26-7"><span class="w">        </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
</span><span id="__span-26-8"><span class="w">    </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-26-9">
</span><span id="__span-26-10"><span class="o">#</span><span class="err">返回优化后的语句：</span><span class="w"> </span>
</span><span id="__span-26-11"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-26-12"><span class="w">    </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">VisitID</span><span class="p">,</span><span class="w"> </span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-26-13"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-26-14"><span class="w">    </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
</span><span id="__span-26-15"><span class="k">ALL</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
</span><span id="__span-26-16"><span class="w">    </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="310">3.10 标量替换<a class="headerlink" href="#310" title="Permanent link">&para;</a></h3>
<p>如果子查询只返回一行数据，在被引用的时候用标量替换，例如下面语句中的 <code>total_disk_usage</code> 字段：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-27-2"><span class="k">WITH</span><span class="w"> </span>
</span><span id="__span-27-3"><span class="p">(</span><span class="w"> </span>
</span><span id="__span-27-4"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-27-5"><span class="w">        </span><span class="k">sum</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-27-6"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-27-7"><span class="w">        </span><span class="k">system</span><span class="p">.</span><span class="n">parts</span><span class="w"> </span>
</span><span id="__span-27-8"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-27-9"><span class="w">        </span><span class="n">active</span><span class="w"> </span>
</span><span id="__span-27-10"><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_disk_usage</span><span class="w"> </span>
</span><span id="__span-27-11"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-27-12"><span class="w">    </span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_disk_usage</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_disk_usage</span><span class="p">,</span><span class="w"> </span><span class="k">table</span><span class="w"> </span>
</span><span id="__span-27-13"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-27-14"><span class="w">    </span><span class="k">system</span><span class="p">.</span><span class="n">parts</span><span class="w"> </span>
</span><span id="__span-27-15"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-27-16"><span class="w">    </span><span class="k">table</span><span class="w"> </span>
</span><span id="__span-27-17"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-27-18"><span class="w">    </span><span class="n">table_disk_usage</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
</span><span id="__span-27-19"><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-27-20"><span class="o">#</span><span class="err">返回优化后的语句：</span><span class="w"> </span>
</span><span id="__span-27-21"><span class="k">WITH</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;UInt64\&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_disk_usage</span><span class="w"> </span>
</span><span id="__span-27-22"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-27-23"><span class="w">    </span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_disk_usage</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">table_disk_usage</span><span class="p">,</span><span class="w"> </span><span class="k">table</span><span class="w"> </span>
</span><span id="__span-27-24"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-27-25"><span class="w">    </span><span class="k">system</span><span class="p">.</span><span class="n">parts</span><span class="w"> </span>
</span><span id="__span-27-26"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-27-27"><span class="w">    </span><span class="k">table</span><span class="w"> </span>
</span><span id="__span-27-28"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-27-29"><span class="w">    </span><span class="n">table_disk_usage</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
</span><span id="__span-27-30"><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="311">3.11 三元运算优化<a class="headerlink" href="#311" title="Permanent link">&para;</a></h3>
<p>如果开启了 <code>optimize_if_chain_to_multiif</code> 参数，三元运算符会被替换成 <code>multiIf</code> 函数，例如：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">SYNTAX</span><span class="w"> </span>
</span><span id="__span-28-2"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-28-3"><span class="w">    </span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;atguigu&#39;</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-28-4"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-28-5"><span class="w">    </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">optimize_if_chain_to_multiif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-28-6">
</span><span id="__span-28-7"><span class="o">#</span><span class="err">返回优化后的语句：</span><span class="w"> </span>
</span><span id="__span-28-8"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-28-9"><span class="w">    </span><span class="n">multiIf</span><span class="p">(</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;hello\&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;world\&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">\</span><span class="s1">&#39;atguigu\&#39;</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-28-10"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-28-11"><span class="w">    </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-28-12"><span class="n">SETTINGS</span><span class="w"> </span><span class="n">optimize_if_chain_to_multiif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="4">4 查询优化<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 单表查询<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<h4 id="411-prewhere-where">4.1.1 Prewhere 替代 where<a class="headerlink" href="#411-prewhere-where" title="Permanent link">&para;</a></h4>
<p><code>Prewhere</code> 和 <code>where</code> 语句的作用相同，用来过滤数据。不同之处在于 <code>prewhere</code> 只支持 <code>*MergeTree</code> 族系列引擎的表，首先会读取指定的列数据，来判断数据过滤，等待数据过滤之后再读取 <code>select</code> 声明的列字段来补全其余属性。</p>
<p>当查询列明显多于筛选列时使用 <code>Prewhere</code> 可十倍提升查询性能， <code>Prewhere</code> 会自动优化执行过滤阶段的数据读取方式，降低 <code>io</code> 操作。</p>
<p>在某些场合下， <code>prewhere</code> 语句比 <code>where</code> 语句处理的数据量更少性能更高。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><span class="o">#</span><span class="err">关闭</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">自动转</span><span class="w"> </span><span class="n">prewhere</span><span class="p">(</span><span class="err">默认情况下，</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="err">条件会自动优化成</span><span class="w"> </span><span class="n">prewhere</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-29-2"><span class="k">set</span><span class="w"> </span><span class="n">optimize_move_to_prewhere</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-29-3"><span class="o">#</span><span class="err">使用</span><span class="w"> </span><span class="k">where</span><span class="w"> </span>
</span><span id="__span-29-4"><span class="k">select</span><span class="w"> </span>
</span><span id="__span-29-5"><span class="w">    </span><span class="n">WatchID</span><span class="p">,</span><span class="w"> </span><span class="n">JavaEnable</span><span class="p">,</span><span class="w"> </span><span class="n">Title</span><span class="p">,</span><span class="w"> </span><span class="n">GoodEvent</span><span class="p">,</span><span class="w"> </span><span class="n">EventTime</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP6</span><span class="p">,</span><span class="w"> </span><span class="n">RegionID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">CounterClass</span><span class="p">,</span><span class="w"> </span><span class="n">OS</span><span class="p">,</span><span class="w"> </span><span class="n">UserAgent</span><span class="p">,</span><span class="w"> </span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">Referer</span><span class="p">,</span><span class="w"> </span><span class="n">URLDomain</span><span class="p">,</span><span class="w"> </span><span class="n">RefererDomain</span><span class="p">,</span><span class="w"> </span><span class="n">Refresh</span><span class="p">,</span><span class="w"> </span><span class="n">IsRobot</span><span class="p">,</span><span class="w"> </span><span class="n">RefererCategories</span><span class="p">,</span><span class="w"> </span><span class="n">URLCategories</span><span class="p">,</span><span class="w"> </span><span class="n">URLRegions</span><span class="p">,</span><span class="w"> </span><span class="n">RefererRegions</span><span class="p">,</span><span class="w"> </span><span class="n">ResolutionWidth</span><span class="p">,</span><span class="w"> </span><span class="n">ResolutionHeight</span><span class="p">,</span><span class="w"> </span><span class="n">ResolutionDepth</span><span class="p">,</span><span class="w"> </span><span class="n">FlashMajor</span><span class="p">,</span><span class="w"> </span><span class="n">FlashMinor</span><span class="p">,</span><span class="w"> </span><span class="n">FlashMinor2</span><span class="w"> </span>
</span><span id="__span-29-6"><span class="k">from</span><span class="w"> </span>
</span><span id="__span-29-7"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-29-8"><span class="k">where</span><span class="w"> </span>
</span><span id="__span-29-9"><span class="w">    </span><span class="n">UserID</span><span class="o">=</span><span class="s1">&#39;3198390223272470366&#39;</span><span class="p">;</span>
</span><span id="__span-29-10"><span class="o">#</span><span class="err">使用</span><span class="w"> </span><span class="n">prewhere</span><span class="w"> </span><span class="err">关键字</span><span class="w"> </span>
</span><span id="__span-29-11"><span class="k">select</span><span class="w"> </span>
</span><span id="__span-29-12"><span class="w">    </span><span class="n">WatchID</span><span class="p">,</span><span class="w"> </span><span class="n">JavaEnable</span><span class="p">,</span><span class="n">Title</span><span class="p">,</span><span class="w"> </span><span class="n">GoodEvent</span><span class="p">,</span><span class="w"> </span><span class="n">EventTime</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP6</span><span class="p">,</span><span class="w"> </span><span class="n">RegionID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">CounterClass</span><span class="p">,</span><span class="w"> </span><span class="n">OS</span><span class="p">,</span><span class="w"> </span><span class="n">UserAgent</span><span class="p">,</span><span class="w"> </span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">Referer</span><span class="p">,</span><span class="w"> </span><span class="n">URLDomain</span><span class="p">,</span><span class="w"> </span><span class="n">RefererDomain</span><span class="p">,</span><span class="w"> </span><span class="n">Refresh</span><span class="p">,</span><span class="w"> </span><span class="n">IsRobot</span><span class="p">,</span><span class="w"> </span><span class="n">RefererCategories</span><span class="p">,</span><span class="w"> </span><span class="n">URLCategories</span><span class="p">,</span><span class="w"> </span><span class="n">URLRegions</span><span class="p">,</span><span class="w"> </span><span class="n">RefererRegions</span><span class="p">,</span><span class="w"> </span><span class="n">ResolutionWidth</span><span class="p">,</span><span class="w"> </span><span class="n">ResolutionHeight</span><span class="p">,</span><span class="w"> </span><span class="n">ResolutionDepth</span><span class="p">,</span><span class="w"> </span><span class="n">FlashMajor</span><span class="p">,</span><span class="w"> </span><span class="n">FlashMinor</span><span class="p">,</span><span class="w"> </span><span class="n">FlashMinor2</span><span class="w"> </span>
</span><span id="__span-29-13"><span class="k">from</span><span class="w"> </span>
</span><span id="__span-29-14"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-29-15"><span class="n">prewhere</span><span class="w"> </span>
</span><span id="__span-29-16"><span class="w">    </span><span class="n">UserID</span><span class="o">=</span><span class="s1">&#39;3198390223272470366&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>默认情况，我们肯定不会关闭 <code>where</code> 自动优化成 <code>prewhere</code> ，但是某些场景即使开启优化，也不会自动转换成 <code>prewhere</code> ，需要手动指定 <code>prewhere</code> ：</p>
<ul>
<li>
<p>使用常量表达式</p>
</li>
<li>
<p>使用默认值为 <code>alias</code> 类型的字段</p>
</li>
<li>
<p>包含了 <code>arrayJOIN</code> ， <code>globalIn</code> ， <code>globalNotIn</code> 或者 <code>indexHint</code> 的查询</p>
</li>
<li>
<p><code>select</code> 查询的列字段和 <code>where</code> 的谓词相同</p>
</li>
<li>
<p>使用了主键字段</p>
</li>
</ul>
<h4 id="412">4.1.2 数据采样<a class="headerlink" href="#412" title="Permanent link">&para;</a></h4>
<p>通过采样运算可极大提升数据分析的性能</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-30-2"><span class="w">    </span><span class="n">Title</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PageViews</span><span class="w"> </span>
</span><span id="__span-30-3"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-30-4"><span class="w">    </span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-30-5"><span class="n">SAMPLE</span><span class="w"> </span>
</span><span id="__span-30-6"><span class="w">    </span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="w"> </span><span class="o">#</span><span class="err">代表采样</span><span class="w"> </span><span class="mi">10</span><span class="o">%</span><span class="err">的数据</span><span class="p">,</span><span class="err">也可以是具体的条数</span><span class="w"> </span>
</span><span id="__span-30-7"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-30-8"><span class="w">    </span><span class="n">CounterID</span><span class="w"> </span><span class="o">=</span><span class="mi">57</span><span class="w"> </span>
</span><span id="__span-30-9"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-30-10"><span class="w">    </span><span class="n">Title</span><span class="w"> </span>
</span><span id="__span-30-11"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-30-12"><span class="w">    </span><span class="n">PageViews</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
</span><span id="__span-30-13"><span class="k">LIMIT</span><span class="w"> </span>
</span><span id="__span-30-14"><span class="w">    </span><span class="mi">1000</span>
</span></code></pre></div></td></tr></table></div>
<p>采样修饰符只有在 <code>MergeTree engine</code> 表中才有效，且在创建表时需要指定采样策略。</p>
<h4 id="413">4.1.3 列裁剪与分区裁剪<a class="headerlink" href="#413" title="Permanent link">&para;</a></h4>
<p>数据量太大时应避免使用 <code>select *</code> 操作，查询的性能会与查询的字段大小和数量成线性表换，字段越少，消耗的 <code>io</code> 资源越少，性能就会越高。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><span class="o">#</span><span class="err">反例</span>
</span><span id="__span-31-2"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-31-3"><span class="o">#</span><span class="err">正例</span>
</span><span id="__span-31-4"><span class="k">select</span><span class="w"> </span>
</span><span id="__span-31-5"><span class="w">    </span><span class="n">WatchID</span><span class="p">,</span><span class="w"> </span><span class="n">JavaEnable</span><span class="p">,</span><span class="w"> </span><span class="n">Title</span><span class="p">,</span><span class="w"> </span><span class="n">GoodEvent</span><span class="p">,</span><span class="w"> </span><span class="n">EventTime</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP6</span><span class="p">,</span><span class="w"> </span><span class="n">RegionID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-31-6"><span class="k">from</span><span class="w"> </span>
</span><span id="__span-31-7"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>分区裁剪就是只读取需要的分区，在过滤条件中指定。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><span class="k">select</span><span class="w"> </span>
</span><span id="__span-32-2"><span class="w">    </span><span class="n">WatchID</span><span class="p">,</span><span class="w"> </span><span class="n">JavaEnable</span><span class="p">,</span><span class="w"> </span><span class="n">Title</span><span class="p">,</span><span class="w"> </span><span class="n">GoodEvent</span><span class="p">,</span><span class="w"> </span><span class="n">EventTime</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP</span><span class="p">,</span><span class="w"> </span><span class="n">ClientIP6</span><span class="p">,</span><span class="w"> </span><span class="n">RegionID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="w"> </span>
</span><span id="__span-32-3"><span class="k">from</span><span class="w"> </span>
</span><span id="__span-32-4"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-32-5"><span class="k">where</span><span class="w"> </span>
</span><span id="__span-32-6"><span class="w">    </span><span class="n">EventDate</span><span class="o">=</span><span class="s1">&#39;2014-03-23&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="414-orderby-wherelimit">4.1.4 orderby 结合 where、limit<a class="headerlink" href="#414-orderby-wherelimit" title="Permanent link">&para;</a></h4>
<p>千万以上数据集进行 <code>order by</code> 查询时需要搭配 <code>where</code> 条件和 <code>limit</code> 语句一起使用。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><span class="o">#</span><span class="err">正例</span>
</span><span id="__span-33-2"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-33-3"><span class="w">    </span><span class="n">UserID</span><span class="p">,</span><span class="n">Age</span><span class="w"> </span>
</span><span id="__span-33-4"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-33-5"><span class="w">    </span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-33-6"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-33-7"><span class="w">    </span><span class="n">CounterID</span><span class="o">=</span><span class="mi">57</span><span class="w"> </span>
</span><span id="__span-33-8"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-33-9"><span class="w">    </span><span class="n">Age</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
</span><span id="__span-33-10"><span class="k">LIMIT</span><span class="w"> </span>
</span><span id="__span-33-11"><span class="w">    </span><span class="mi">1000</span><span class="w"> </span>
</span><span id="__span-33-12">
</span><span id="__span-33-13"><span class="o">#</span><span class="err">反例</span>
</span><span id="__span-33-14"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-33-15"><span class="w">    </span><span class="n">UserID</span><span class="p">,</span><span class="n">Age</span><span class="w"> </span>
</span><span id="__span-33-16"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-33-17"><span class="w">    </span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-33-18"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-33-19"><span class="w">    </span><span class="n">Age</span><span class="w"> </span><span class="k">DESC</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="415">4.1.5 避免构建虚拟列<a class="headerlink" href="#415" title="Permanent link">&para;</a></h4>
<p>如非必须，不要在结果集上构建虚拟列，虚拟列非常消耗资源浪费性能，可以考虑在前端进行处理，或者在表中构造实际字段进行额外存储。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><span class="o">#</span><span class="err">反例</span>
</span><span id="__span-34-2"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-34-3"><span class="w">    </span><span class="n">Income</span><span class="p">,</span><span class="n">Age</span><span class="p">,</span><span class="n">Income</span><span class="o">/</span><span class="n">Age</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">IncRate</span><span class="w"> </span>
</span><span id="__span-34-4"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-34-5"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-34-6">
</span><span id="__span-34-7"><span class="o">#</span><span class="err">正例</span>
</span><span id="__span-34-8"><span class="o">#</span><span class="err">拿到</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="err">和</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="err">后，考虑在前端进行处理，或者在表中构造实际字段进行额外存储</span><span class="w"> </span>
</span><span id="__span-34-9"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-34-10"><span class="w">    </span><span class="n">Income</span><span class="p">,</span><span class="n">Age</span><span class="w"> </span>
</span><span id="__span-34-11"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-34-12"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="416-uniqcombined-distinct">4.1.6 uniqCombined 替代 distinct<a class="headerlink" href="#416-uniqcombined-distinct" title="Permanent link">&para;</a></h4>
<p>性能可提升 <code>10</code> 倍以上， <code>uniqCombined</code> 底层采用类似 <code>HyperLogLog</code> 算法实现，能接收 <code>2%</code> 左右的数据误差，可直接使用这种去重方式提升查询性能。 <code>Count(distinct)</code> 会使用 <code>uniqExact</code> 精确去重。</p>
<p>不建议在千万级不同数据上执行 <code>distinct</code> 去重查询，改为近似去重 <code>uniqCombined</code></p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><span class="o">#</span><span class="err">反例</span>
</span><span id="__span-35-2"><span class="k">select</span><span class="w"> </span>
</span><span id="__span-35-3"><span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">rand</span><span class="p">())</span><span class="w"> </span>
</span><span id="__span-35-4"><span class="k">from</span><span class="w"> </span>
</span><span id="__span-35-5"><span class="w">    </span><span class="n">hits_v1</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-35-6">
</span><span id="__span-35-7"><span class="o">#</span><span class="err">正例</span><span class="w"> </span>
</span><span id="__span-35-8"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-35-9"><span class="w">    </span><span class="n">uniqCombined</span><span class="p">(</span><span class="n">rand</span><span class="p">())</span><span class="w"> </span>
</span><span id="__span-35-10"><span class="k">from</span><span class="w">    </span>
</span><span id="__span-35-11"><span class="w">    </span><span class="n">datasets</span><span class="p">.</span><span class="n">hits_v1</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="417">4.1.7 使用物化视图<a class="headerlink" href="#417" title="Permanent link">&para;</a></h4>
<p>参考第 <code>6</code> 章。</p>
<h4 id="418">4.1.8 其他注意事项<a class="headerlink" href="#418" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>查询熔断</p>
<p>为了避免因个别慢查询引起的服务雪崩的问题，除了可以为单个查询设置超时以外，还可以配置周期熔断，在一个查询周期内，如果用户频繁进行慢查询操作超出规定阈值后将无法继续进行查询操作。</p>
</li>
<li>
<p>关闭虚拟内存</p>
<p>物理内存和虚拟内存的数据交换，会导致查询变慢，资源允许的情况下关闭虚拟内存。</p>
</li>
<li>
<p>配置 <code>join_use_nulls</code></p>
<p>为每一个账户添加 <code>join_use_nulls</code> 配置，左表中的一条记录在右表中不存在，右表的相应字段会返回该字段相应数据类型的默认值，而不是标准 <code>SQL</code> 中的 <code>Null</code> 值。</p>
</li>
<li>
<p>批量写入时先排序</p>
<p>批量写入数据时，必须控制每个批次的数据中涉及到的分区的数量，在写入之前最好对需要导入的数据进行排序。无序的数据或者涉及的分区太多，会导致 <code>ClickHouse</code> 无法及时对新导入的数据进行合并，从而影响查询性能。</p>
</li>
<li>
<p>关注 <code>CPU</code></p>
<p><code>cpu</code> 一般在 <code>50%</code> 左右会出现查询波动，达到 <code>70%</code> 会出现大范围的查询超时， <code>cpu</code> 是最关键的指标，要非常关注。</p>
</li>
</ol>
<h3 id="42">4.2 多表关联<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<h4 id="421">4.2.1 准备表和数据<a class="headerlink" href="#421" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><span class="o">#</span><span class="err">创建小表</span><span class="w"> </span>
</span><span id="__span-36-2"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span>
</span><span id="__span-36-3"><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CollapsingMergeTree</span><span class="p">(</span><span class="n">Sign</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-36-4"><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">StartDate</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-36-5"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">StartDate</span><span class="p">,</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">),</span><span class="w"> </span><span class="n">VisitID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-36-6"><span class="n">SAMPLE</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-36-7"><span class="n">SETTINGS</span><span class="w"> </span><span class="n">index_granularity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8192</span><span class="w"> </span>
</span><span id="__span-36-8"><span class="k">as</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-36-9"><span class="o">#</span><span class="err">创建</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="err">结果表：避免控制台疯狂打印数据</span><span class="w"> </span>
</span><span id="__span-36-10"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span>
</span><span id="__span-36-11"><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MergeTree</span><span class="p">()</span><span class="w"> </span>
</span><span id="__span-36-12"><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-36-13"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">))</span><span class="w"> </span>
</span><span id="__span-36-14"><span class="n">SAMPLE</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-36-15"><span class="n">SETTINGS</span><span class="w"> </span><span class="n">index_granularity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8192</span><span class="w"> </span>
</span><span id="__span-36-16"><span class="k">as</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="422-in-join">4.2.2 用 IN 代替 JOIN<a class="headerlink" href="#422-in-join" title="Permanent link">&para;</a></h4>
<p>当多表联查时，查询的数据仅从其中一张表出时，可考虑用 <code>IN</code> 操作而不是 <code>JOIN</code></p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">CounterID</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="p">);</span>
</span><span id="__span-37-2"><span class="o">#</span><span class="err">反例：使用</span><span class="w"> </span><span class="k">join</span><span class="w"> </span>
</span><span id="__span-37-3"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="423-join">4.2.3 大小表 JOIN<a class="headerlink" href="#423-join" title="Permanent link">&para;</a></h4>
<p>多表 <code>join</code> 时要满足小表在右的原则，右表关联时被加载到内存中与左表进行比较， <code>ClickHouse</code> 中无论是 <code>Left join</code> 、 <code>Right join</code> 还是 <code>Inner join</code> 永远都是拿着右表中的每一条记录到左表中查找该记录是否存在，所以右表必须是小表。</p>
<ol>
<li>
<p>小表在右</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>大表在右</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="424">4.2.4 注意谓词下推（版本差异）<a class="headerlink" href="#424" title="Permanent link">&para;</a></h4>
<p><code>ClickHouse</code> 在 <code>join</code> 查询时不会主动发起谓词下推的操作，需要每个子查询提前完成过滤操作，需要注意的是，是否执行谓词下推，对性能影响差别很大（新版本中已经不存在此问题，但是需要注意谓词的位置的不同依然有性能的差异）</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><span class="k">Explain</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span>
</span><span id="__span-40-2"><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="w"> </span><span class="k">having</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">EventDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-40-3"><span class="k">Explain</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span>
</span><span id="__span-40-4"><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="w"> </span><span class="k">having</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-40-5"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">EventDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-40-6"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">hits_v2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">EventDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">visits_v2</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="n">CounterID</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="425-global">4.2.5 分布式表使用 GLOBAL<a class="headerlink" href="#425-global" title="Permanent link">&para;</a></h4>
<p>两张分布式表上的 <code>IN</code> 和 <code>JOIN</code> 之前必须加上 <code>GLOBAL</code> 关键字，右表只会在接收查询请求的那个节点查询一次，并将其分发到其他节点上。如果不加 <code>GLOBAL</code> 关键字的话，每个节点都会单独发起一次对右表的查询，而右表又是分布式表，就导致右表一共会被查询 <code>N²</code> 次（ <code>N</code> 是该分布式表的分片数量），这就是查询放大，会带来很大开销。</p>
<h4 id="426">4.2.6 使用字典表<a class="headerlink" href="#426" title="Permanent link">&para;</a></h4>
<p>将一些需要关联分析的业务创建成字典表进行 <code>join</code> 操作，前提是字典表不宜太大，因为字典表会常驻内存</p>
<h4 id="427">4.2.7 提前过滤<a class="headerlink" href="#427" title="Permanent link">&para;</a></h4>
<p>通过增加逻辑过滤可以减少数据扫描，达到提高执行速度及降低内存消耗的目的</p>
<h2 id="5">5 数据一致性（重点）<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<p>查询 <code>CK</code> 手册发现，即便对数据一致性支持最好的 <code>Mergetree</code> ，也只是保证最终一致性：</p>
<p><code>ReplacingMergeTree</code> ，该引擎和 <code>MergeTree</code> 的不同之处在于它会删除排序键值相同的重复项。数据的去重只会在数据合并期间进行。合并会在后台一个不确定的时间进行，因此你无法预先做出计划。有一些数据可能仍未被处理。尽管你可以调用 <code>OPTIMIZE</code> 语句发起计划外的合并，但请不要依靠它，因为 <code>OPTIMIZE</code> 语句会引发对数据的大量读写。因此， <code>ReplacingMergeTree</code> 适用于在后台清楚重复的数据以节省空间，但是它不保证没有重复的数据出现。</p>
<p>我们在使用 <code>ReplacingMergeTree</code> 、 <code>SummingMergeTree</code> 这类表引擎的时候，会出现短暂数据不一致的情况。</p>
<p>在某些对一致性非常敏感的场景，通常有以下几种解决方案。</p>
<h3 id="51">5.1 准备测试表和数据<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>创建表</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_a</span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-41-2"><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">UInt64</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-41-3"><span class="w">    </span><span class="n">score</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-41-4"><span class="w">    </span><span class="n">deleted</span><span class="w"> </span><span class="n">UInt8</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-41-5"><span class="w">    </span><span class="n">create_time</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">toDateTime</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-41-6"><span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="w"> </span><span class="n">ReplacingMergeTree</span><span class="p">(</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-41-7"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>其中：</p>
<p><code>user_id</code> 是数据去重更新的标识；</p>
<p><code>create_time</code> 是版本号字段，每组数据中 <code>create_time</code> 最大的一行表示最新的数据；</p>
<p><code>deleted</code> 是自定的一个标记位，比如 <code>0</code> 代表未删除， <code>1</code> 代表删除数据。</p>
</li>
<li>
<p>写入 <code>1000</code> 万测试数据</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_a</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="n">score</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-42-2"><span class="k">WITH</span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-42-3"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">]</span><span class="w"> </span>
</span><span id="__span-42-4"><span class="p">)</span><span class="k">AS</span><span class="w"> </span><span class="n">dict</span><span class="w"> </span>
</span><span id="__span-42-5"><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">[</span><span class="nb">number</span><span class="o">%</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">(</span><span class="mi">10000000</span><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>修改前 <code>50</code> 万行数据，修改内容包括 <code>name</code> 字段和 <code>create_time</code> 版本号字段</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_a</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="n">score</span><span class="p">,</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-43-2"><span class="k">WITH</span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-43-3"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="s1">&#39;BB&#39;</span><span class="p">,</span><span class="s1">&#39;CC&#39;</span><span class="p">,</span><span class="s1">&#39;DD&#39;</span><span class="p">,</span><span class="s1">&#39;EE&#39;</span><span class="p">,</span><span class="s1">&#39;FF&#39;</span><span class="p">,</span><span class="s1">&#39;GG&#39;</span><span class="p">]</span><span class="w"> </span>
</span><span id="__span-43-4"><span class="p">)</span><span class="k">AS</span><span class="w"> </span><span class="n">dict</span><span class="w"> </span>
</span><span id="__span-43-5"><span class="k">SELECT</span><span class="w"> </span><span class="nb">number</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">[</span><span class="nb">number</span><span class="o">%</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">create_time</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">(</span><span class="mi">500000</span><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>统计总数</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">()</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_a</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-44-2"><span class="mi">10500000</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>还未触发分区合并，所以还未去重。</p>
<h3 id="52-optimize">5.2 手动 OPTIMIZE<a class="headerlink" href="#52-optimize" title="Permanent link">&para;</a></h3>
<p>在写入数据后，立刻执行 <code>OPTIMIZE</code> 强制触发新写入分区的合并动作。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><span class="n">OPTIMIZE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_a</span><span class="w"> </span><span class="k">FINAL</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-45-2"><span class="o">#</span><span class="err">语法：</span>
</span><span id="__span-45-3"><span class="n">OPTIMIZE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="n">name</span><span class="w"> </span><span class="p">[</span><span class="k">ON</span><span class="w"> </span><span class="k">CLUSTER</span><span class="w"> </span><span class="k">cluster</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">PARTITION</span><span class="w"> </span><span class="n">partition</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="s1">&#39;partition_id&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">FINAL</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">DEDUPLICATE</span><span class="w"> </span><span class="p">[</span><span class="k">BY</span><span class="w"> </span><span class="n">expression</span><span class="p">]]</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="53-group-by">5.3 通过 Group by 去重<a class="headerlink" href="#53-group-by" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>执行去重的查询</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-46-2"><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">argMax</span><span class="p">(</span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="n">argMax</span><span class="p">(</span><span class="n">deleted</span><span class="p">,</span><span class="w"> </span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">deleted</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ctime</span><span class="w"> </span>
</span><span id="__span-46-3"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-46-4"><span class="w">    </span><span class="n">test_a</span><span class="w"> </span>
</span><span id="__span-46-5"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-46-6"><span class="w">    </span><span class="n">user_id</span><span class="w"> </span>
</span><span id="__span-46-7"><span class="k">HAVING</span><span class="w"> </span>
</span><span id="__span-46-8"><span class="w">    </span><span class="n">deleted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>函数说明：</p>
<ul>
<li><code>argMax(field1,field2)</code> ：按照 <code>field2</code> 的最大值取 <code>field1</code> 的值。</li>
</ul>
<p>当我们更新数据时，会写入一行新的数据，例如上面语句中，通过查询最大的 <code>create_time</code> 得到修改后的 <code>score</code> 字段值。</p>
</li>
<li>
<p>创建视图，方便测试</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">view_test_a</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
</span><span id="__span-47-2"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-47-3"><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">argMax</span><span class="p">(</span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">score</span><span class="p">,</span><span class="w"> </span><span class="n">argMax</span><span class="p">(</span><span class="n">deleted</span><span class="p">,</span><span class="w"> </span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">deleted</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ctime</span><span class="w"> </span>
</span><span id="__span-47-4"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-47-5"><span class="w">    </span><span class="n">test_a</span><span class="w"> </span>
</span><span id="__span-47-6"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-47-7"><span class="w">    </span><span class="n">user_id</span><span class="w"> </span>
</span><span id="__span-47-8"><span class="k">HAVING</span><span class="w"> </span>
</span><span id="__span-47-9"><span class="w">    </span><span class="n">deleted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>插入重复数据，再次查询</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-1"><span class="o">#</span><span class="err">再次插入一条数据</span><span class="w"> </span>
</span><span id="__span-48-2"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_a</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="n">score</span><span class="p">,</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;AAAA&#39;</span><span class="p">,</span><span class="n">now</span><span class="p">())</span><span class="w"> </span>
</span><span id="__span-48-3"><span class="o">#</span><span class="err">再次查询</span><span class="w"> </span>
</span><span id="__span-48-4"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">view_test_a</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>删除数据测试</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><span class="o">#</span><span class="err">再次插入一条标记为删除的数据</span><span class="w"> </span>
</span><span id="__span-49-2"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_a</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="n">score</span><span class="p">,</span><span class="n">deleted</span><span class="p">,</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;AAAA&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">now</span><span class="p">());</span><span class="w"> </span>
</span><span id="__span-49-3"><span class="o">#</span><span class="err">再次查询，刚才那条数据看不到了</span><span class="w"> </span>
</span><span id="__span-49-4"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">view_test_a</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>这行数据并没有被真正的删除，而是被过滤掉了。在一些合适的场景下，可以结合表级别的 <code>TTL</code> 最终将物理数据删除。</p>
<h3 id="54-final">5.4 通过 FINAL 查询<a class="headerlink" href="#54-final" title="Permanent link">&para;</a></h3>
<p>在查询语句后增加 <code>FINAL</code> 修饰符，这样在查询的过程中将会执行 <code>Merge</code> 的特殊逻辑（例如数据去重，预聚合等）。</p>
<p>但是这种方法在早期版本基本没有人使用，因为在增加 <code>FINAL</code> 之后，我们的查询将会变成一个单线程的执行过程，查询速度非常慢。</p>
<p>在 <code>v20.5.2.7-stable</code> 版本中， <code>FINAL</code> 查询支持多线程执行，并且可以通过 <code>max_final_threads</code> 参数控制单个查询的线程数。但是目前读取 <code>part</code> 部分的动作依然是串行的。</p>
<p><code>FINAL</code> 查询最终的性能和很多因素相关，列字段的大小、分区的数量等等都会影响到最终的查询时间，所以还要结合实际场景取舍。</p>
<p>参考链接：<a href="https://github.com/ClickHouse/ClickHouse/pull/10463">https://github.com/ClickHouse/ClickHouse/pull/10463</a></p>
<p>使用 <code>hits_v1</code> 表进行测试：</p>
<p>分别安装了 <code>20.4.5.36</code> 和 <code>21.7.3.14</code> 两个版本的 <code>ClickHouse</code> 进行对比。</p>
<h4 id="541">5.4.1 老版本测试<a class="headerlink" href="#541" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>普通查询语句</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p><code>FINAL</code> 查询</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-51-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">FINAL</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>先前的并行查询变成了单线程。</p>
<h4 id="542">5.4.2 新版本测试<a class="headerlink" href="#542" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>普通语句查询</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">max_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>查看执行计划：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-1"><span class="k">explain</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">max_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-53-2"><span class="p">(</span><span class="n">Expression</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-53-3"><span class="n">ExpressionTransform</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-53-4"><span class="w">    </span><span class="p">(</span><span class="n">SettingQuotaAndLimits</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-53-5"><span class="w">        </span><span class="p">(</span><span class="k">Limit</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-53-6"><span class="w">        </span><span class="k">Limit</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-53-7"><span class="w">            </span><span class="p">(</span><span class="n">ReadFromMergeTree</span><span class="p">)</span>
</span><span id="__span-53-8"><span class="w">        </span><span class="n">MergeTreeThread</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
<p>明显将由 <code>2</code> 个线程并行读取 <code>part</code> 查询。</p>
</li>
<li>
<p><code>FINAL</code> 查询</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-17&#39;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">max_final_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>查询速度没有普通的查询快，但是相比之前已经有了一些提升，查看 <code>FINAL</code> 查询的执行计划：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-55-1"><span class="k">explain</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">visits_v1</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">StartDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014- 03-17&#39;</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">max_final_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-55-2"><span class="p">(</span><span class="n">Expression</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-55-3"><span class="n">ExpressionTransform</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-55-4"><span class="w">    </span><span class="p">(</span><span class="n">SettingQuotaAndLimits</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-55-5"><span class="w">        </span><span class="p">(</span><span class="k">Limit</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-55-6"><span class="w">        </span><span class="k">Limit</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-55-7"><span class="w">            </span><span class="p">(</span><span class="n">ReadFromMergeTree</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-55-8"><span class="w">            </span><span class="n">ExpressionTransform</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-55-9"><span class="w">                </span><span class="n">CollapsingSortedTransform</span><span class="w"> </span><span class="err">×</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-55-10"><span class="w">                    </span><span class="k">Copy</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span>
</span><span id="__span-55-11"><span class="w">                        </span><span class="n">AddingSelector</span><span class="w"> </span>
</span><span id="__span-55-12"><span class="w">                            </span><span class="n">ExpressionTransform</span><span class="w"> </span>
</span><span id="__span-55-13"><span class="w">                                </span><span class="n">MergeTree</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>从 <code>CollapsingSortedTransform</code> 这一步开始已经是多线程执行，但是读取 <code>part</code> 部分的动作还是串行。</p>
<h2 id="6">6 物化视图<a class="headerlink" href="#6" title="Permanent link">&para;</a></h2>
<p><code>ClickHouse</code> 的物化视图是一种查询结果的持久化，它确实是给我们带来了查询效率的提升。用户查起来跟表没有区别，它就是一张表，它也像是一张时刻在预计算的表，创建的过程它是用了一个特殊引擎，加上后来 <code>as select</code> ，就是 <code>create</code> 一个 <code>table as select</code> 的写法。</p>
<p>“查询结果集”的范围很宽泛，可以是基础表中部分数据的一份简单拷贝，也可以是多表 <code>join</code> 之后产生的结果或其子集，或者原始数据的聚合指标等等。所以，物化视图不会随着基础表的变化而变化，所以它也称为快照（ <code>snapshot</code> ）</p>
<h3 id="61">6.1 概述<a class="headerlink" href="#61" title="Permanent link">&para;</a></h3>
<h4 id="611">6.1.1 物化视图与普通视图的区别<a class="headerlink" href="#611" title="Permanent link">&para;</a></h4>
<p>普通视图不保存数据，保存的仅仅是查询语句，查询的时候还是从原表读取数据，可以将普通视图理解为是个子查询。物化视图则是把查询的结果根据相应的引擎存入到了磁盘或内存中，对数据重新进行了组织，你可以理解物化视图是完全的一张新表。</p>
<h4 id="612">6.1.2 优缺点<a class="headerlink" href="#612" title="Permanent link">&para;</a></h4>
<p>优点：查询速度快，要是把物化视图这些规则全部写好，它比原数据查询快了很多，总的行数少了，因为都预计算好了。</p>
<p>缺点：它的本质是一个流式数据的使用场景，是累加式的技术，所以要用历史数据做去重、去核这样的分析，在物化视图里面是不太好用的。在某些场景的使用也是有限的。而且如果一张表加了好多物化视图，在写这张表的时候，就会消耗很多机器的资源，比如数据带宽占满、存储一下子增加了很多。</p>
<h4 id="613">6.1.3 基本语法<a class="headerlink" href="#613" title="Permanent link">&para;</a></h4>
<p>也是 <code>create</code> 语法，会创建一个隐藏的目标表来保存视图数据。也可以 <code>TO</code> 表名，保存到一张显式的表。没有加 <code>TO</code> 表名，表名默认就是 <code>.inner.物化视图名</code></p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-1"><span class="k">CREATE</span><span class="w"> </span><span class="p">[</span><span class="n">MATERIALIZED</span><span class="p">]</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="p">[</span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table_name</span><span class="w"> </span><span class="p">[</span><span class="k">TO</span><span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">POPULATE</span><span class="p">]</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>
<p>创建物化视图的限制</p>
<ol>
<li>
<p>必须指定物化视图的 <code>engine</code> 用于数据存储</p>
</li>
<li>
<p><code>TO [db].[table]</code> 语法的时候，不得使用 <code>POPULATE</code> 。</p>
</li>
<li>
<p>查询语句（ <code>select</code> ）可以包含下面的子句： <code>DISTINCT</code> ， <code>GROUP BY</code> ， <code>ORDER BY</code> ， <code>LIMIT</code> <code>...</code></p>
</li>
<li>
<p>物化视图的 <code>alter</code> 操作有些限制，操作起来不大方便。</p>
</li>
<li>
<p>若物化视图的定义使用了 <code>TO [db.]name</code> 子语句，则可以将目标表的视图卸载 <code>DETACH</code> 再装载 <code>ATTACH</code></p>
</li>
</ol>
</li>
<li>
<p>物化视图的数据更新</p>
<ol>
<li>
<p>物化视图创建好之后，若源表被写入新数据则物化视图也会同步更新</p>
</li>
<li>
<p><code>POPULATE</code> 关键字决定了物化视图的更新策略：</p>
<ul>
<li>
<p>若有 <code>POPULATE</code> 则在创建视图的过程会将源表已经存在的数据一并导入，类似于 <code>create table ... as</code></p>
</li>
<li>
<p>若无 <code>POPULATE</code> 则物化视图在创建之后没有数据，只会在创建只有同步之后写入源表的数据</p>
</li>
<li>
<p><code>clickhouse</code> 官方并不推荐使用 <code>POPULATE</code> ，因为在创建物化视图的过程中同时写入的数据不能被插入物化视图。</p>
</li>
</ul>
</li>
<li>
<p>物化视图不支持同步删除，若源表的数据不存在（删除了）则物化视图的数据仍然保留</p>
</li>
<li>
<p>物化视图是一种特殊的数据表，可以用 <code>show tables</code> 查看</p>
</li>
<li>
<p>物化视图数据的删除：</p>
</li>
<li>
<p>物化视图的删除：</p>
</li>
</ol>
</li>
</ol>
<h3 id="62">6.2 案例实操<a class="headerlink" href="#62" title="Permanent link">&para;</a></h3>
<p>对于一些确定的数据模型，可将统计指标通过物化视图的方式进行构建，这样可避免查询时重复计算的过程，物化视图会在有新数据插入时进行更新。</p>
<h4 id="621">6.2.1 准备测试用表和数据<a class="headerlink" href="#621" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>建表</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-57-1"><span class="o">#</span><span class="err">建表语句</span><span class="w"> </span>
</span><span id="__span-57-2"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">hits_test</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-57-3"><span class="w">    </span><span class="n">EventDate</span><span class="w"> </span><span class="nb">Date</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-57-4"><span class="w">    </span><span class="n">CounterID</span><span class="w"> </span><span class="n">UInt32</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-57-5"><span class="w">    </span><span class="n">UserID</span><span class="w"> </span><span class="n">UInt64</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-57-6"><span class="w">    </span><span class="n">URL</span><span class="w"> </span><span class="n">String</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-57-7"><span class="w">    </span><span class="n">Income</span><span class="w"> </span><span class="n">UInt8</span><span class="w"> </span>
</span><span id="__span-57-8"><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MergeTree</span><span class="p">()</span><span class="w"> </span>
</span><span id="__span-57-9"><span class="w">    </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-57-10"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">))</span><span class="w"> </span>
</span><span id="__span-57-11"><span class="w">    </span><span class="n">SAMPLE</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-57-12"><span class="w">    </span><span class="n">SETTINGS</span><span class="w"> </span><span class="n">index_granularity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8192</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>导入一些数据</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-1"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">hits_test</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hits_v1</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="622">6.2.2 创建物化视图<a class="headerlink" href="#622" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-59-1"><span class="o">#</span><span class="err">建表语句</span><span class="w"> </span>
</span><span id="__span-59-2"><span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">hits_mv</span><span class="w"> </span>
</span><span id="__span-59-3"><span class="n">ENGINE</span><span class="o">=</span><span class="n">SummingMergeTree</span><span class="w"> </span>
</span><span id="__span-59-4"><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="p">(</span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">))</span><span class="w"> </span>
</span><span id="__span-59-5"><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-59-6"><span class="n">UserID</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-59-7"><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-59-8"><span class="k">count</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ClickCount</span><span class="p">,</span>
</span><span id="__span-59-9"><span class="k">sum</span><span class="p">(</span><span class="n">Income</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IncomeSum</span><span class="w"> </span>
</span><span id="__span-59-10"><span class="k">FROM</span><span class="w"> </span><span class="n">hits_test</span><span class="w"> </span>
</span><span id="__span-59-11"><span class="k">WHERE</span><span class="w"> </span><span class="n">EventDate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2014-03-20&#39;</span><span class="w"> </span><span class="o">//</span><span class="err">设置更新点</span><span class="p">,</span><span class="err">该时间点之前的数据可以另外通过</span><span class="w"> </span><span class="o">//</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="err">……</span><span class="w"> </span><span class="err">的方式进行插入</span>
</span><span id="__span-59-12"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">UserID</span><span class="p">,</span><span class="n">EventDate</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-59-13"><span class="o">#</span><span class="err">或者可以用下列语法，表</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="err">可以是一张</span><span class="w"> </span><span class="n">mergetree</span><span class="w"> </span><span class="err">表</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="err">物化视图名</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="err">表</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="err">表</span><span class="w"> </span><span class="n">B</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-59-14"><span class="o">#</span><span class="err">不建议添加</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="err">关键字进行全量更新</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="633">6.3.3 导入增量数据<a class="headerlink" href="#633" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-60-1"><span class="o">#</span><span class="err">导入增量数据</span><span class="w"> </span>
</span><span id="__span-60-2"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">hits_test</span><span class="w"> </span>
</span><span id="__span-60-3"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-60-4"><span class="w">    </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="n">CounterID</span><span class="p">,</span><span class="w"> </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">Income</span><span class="w"> </span>
</span><span id="__span-60-5"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-60-6"><span class="w">    </span><span class="n">hits_v1</span><span class="w"> </span>
</span><span id="__span-60-7"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-60-8"><span class="w">    </span><span class="n">EventDate</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;2014-03-23&#39;</span><span class="w"> </span>
</span><span id="__span-60-9"><span class="k">limit</span><span class="w"> </span>
</span><span id="__span-60-10"><span class="w">    </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-60-11">
</span><span id="__span-60-12"><span class="o">#</span><span class="err">查询物化视图</span><span class="w"> </span>
</span><span id="__span-60-13"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hits_mv</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="634">6.3.4 导入历史数据<a class="headerlink" href="#634" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-61-1"><span class="o">#</span><span class="err">导入增量数据</span><span class="w"> </span>
</span><span id="__span-61-2"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">hits_mv</span><span class="w"> </span>
</span><span id="__span-61-3"><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-61-4"><span class="w">    </span><span class="n">UserID</span><span class="p">,</span><span class="w"> </span><span class="n">EventDate</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ClickCount</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">Income</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IncomeSum</span><span class="w"> </span>
</span><span id="__span-61-5"><span class="k">FROM</span><span class="w"> </span>
</span><span id="__span-61-6"><span class="w">    </span><span class="n">hits_test</span><span class="w"> </span>
</span><span id="__span-61-7"><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-61-8"><span class="w">    </span><span class="n">EventDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2014-03-20&#39;</span><span class="w"> </span>
</span><span id="__span-61-9"><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
</span><span id="__span-61-10"><span class="w">    </span><span class="n">UserID</span><span class="p">,</span><span class="n">EventDate</span><span class="w"> </span>
</span><span id="__span-61-11">
</span><span id="__span-61-12"><span class="o">#</span><span class="err">查询物化视图</span><span class="w"> </span>
</span><span id="__span-61-13"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hits_mv</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="7-materializemysql">7 MaterializeMySQL 引擎<a class="headerlink" href="#7-materializemysql" title="Permanent link">&para;</a></h2>
<h3 id="71">7.1 概述<a class="headerlink" href="#71" title="Permanent link">&para;</a></h3>
<p><code>MySQL</code> 的用户群体很大，为了能够增强数据的实时性，很多解决方案会利用 <code>binlog</code> 将数据写入到 <code>ClickHouse</code> 。为了能够监听 <code>binlog</code> 事件，我们需要用到类似 <code>canal</code> 这样的第三方中间件，这无疑增加了系统的复杂度。</p>
<p><code>ClickHouse 20.8.2.3</code> 版本新增加了 <code>MaterializeMySQL</code> 的 <code>database</code> 引擎，该 <code>database</code> 能映射到 <code>MySQL</code> 中的某个 <code>database</code> ，并自动在 <code>ClickHouse</code> 中创建对应的 <code>ReplacingMergeTree</code> 。 <code>ClickHouse</code> 服务做为 <code>MySQL</code> 副本，读取 <code>Binlog</code> 并执行 <code>DDL</code> 和 <code>DML</code> 请求，实现了基于 <code>MySQL Binlog</code> 机制的业务数据库实时同步功能。</p>
<h4 id="711">7.1.1 特点<a class="headerlink" href="#711" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><code>MaterializeMySQL</code> 同时支持全量和增量同步，在 <code>database</code> 创建之初会全量同步 <code>MySQL</code> 中的表和数据，之后则会通过 <code>binlog</code> 进行增量同步。</p>
</li>
<li>
<p><code>MaterializeMySQL database</code> 为其所创建的每张 <code>ReplacingMergeTree</code> 自动增加了 <code>_sign</code> <code>和_version</code> 字段。</p>
</li>
</ol>
<p>其中， <code>_version</code> 用作 <code>ReplacingMergeTree</code> 的 <code>ver</code> 版本参数，每当监听到 <code>insert</code> 、 <code>update</code> 和 <code>delete</code> 事件时，在 <code>databse</code> 内全局自增。而 <code>_sign</code> 则用于标记是否被删除，取值 <code>1</code> 或者 <code>-1</code> 。</p>
<p>目前 <code>MaterializeMySQL</code> 支持如下几种 <code>binlog</code> 事件：</p>
<ul>
<li>
<p><code>MYSQL_WRITE_ROWS_EVENT</code> ： <code>_sign = 1</code> ， <code>_version ++</code></p>
</li>
<li>
<p><code>MYSQL_DELETE_ROWS_EVENT</code> ： <code>_sign = -1</code> ， <code>_version ++</code></p>
</li>
<li>
<p><code>MYSQL_UPDATE_ROWS_EVENT</code> ：新数据 <code>_sign = 1</code></p>
</li>
<li>
<p><code>MYSQL_QUERY_EVENT</code> ：支持 <code>CREATE TABLE</code> 、 <code>DROP TABLE</code> 、 <code>RENAME TABLE</code> 等。</p>
</li>
</ul>
<h4 id="712">7.1.2 使用细则<a class="headerlink" href="#712" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><code>DDL</code> 查询</p>
<p><code>MySQL DDL</code> 查询被转换成相应的 <code>ClickHouse DDL</code> 查询（ <code>ALTER</code> ， <code>CREATE</code> ， <code>DROP</code> ， <code>RENAME</code> ）。如果 <code>ClickHouse</code> 不能解析某些 <code>DDL</code> 查询，该查询将被忽略。</p>
</li>
<li>
<p>数据复制</p>
<p><code>MaterializeMySQL</code> 不支持直接插入、删除和更新查询，而是将 <code>DDL</code> 语句进行相应转换：</p>
<p><code>MySQL INSERT</code> 查询被转换为 <code>INSERT with _sign=1</code> 。 <code>MySQL DELETE</code> 查询被转换为 <code>INSERT with_sign=-1</code> 。</p>
<p><code>MySQL UPDATE</code> 查询被转换成 <code>INSERT with _sign=1</code> 和 <code>INSERT with_sign=-1</code> 。</p>
</li>
<li>
<p><code>SELECT</code> 查询</p>
<p>如果在 <code>SELECT</code> 查询中没有指定 <code>_version</code> ，则使用 <code>FINAL</code> 修饰符，返回 <code>_version</code> 的最大值对应的数据，即最新版本的数据。</p>
<p>如果在 <code>SELECT</code> 查询中没有指定 <code>_sign</code> ，则默认使用 <code>WHERE_sign=1</code> ，即返回未删除状态（ <code>_sign=1</code> ）的数据。</p>
</li>
<li>
<p>索引转换</p>
<p><code>ClickHouse</code> 数据库表会自动将 <code>MySQL</code> 主键和索引子句转换为 <code>ORDER BY</code> 元组。</p>
<p><code>ClickHouse</code> 只有一个物理顺序，由 <code>ORDER BY</code> 子句决定。如果需要创建新的物理顺序，请使用物化视图。</p>
</li>
</ol>
<h3 id="72">7.2 案例实操<a class="headerlink" href="#72" title="Permanent link">&para;</a></h3>
<h4 id="721-mysql-binlog-gtid">7.2.1 MySQL 开启 binlog 和 GTID 模式<a class="headerlink" href="#721-mysql-binlog-gtid" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>确保 <code>MySQL</code> 开启了 <code>binlog</code> 功能，且格式为 <code>ROW</code></p>
<p>打开 <code>/etc/my.cnf</code> ，在 <code>[mysqld]</code> 下添加：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-62-1">server-id<span class="o">=</span><span class="m">1</span><span class="w"> </span>
</span><span id="__span-62-2">log-bin<span class="o">=</span>mysql-bin<span class="w"> </span>
</span><span id="__span-62-3"><span class="nv">binlog_format</span><span class="o">=</span>ROW
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>开启 <code>GTID</code> 模式</p>
<p>如果如果 <code>clickhouse</code> 使用的是 <code>20.8 prestable</code> 之后发布的版本，那么 <code>MySQL</code> 还需要配置开启 <code>GTID</code> 模式，这种方式在 <code>mysql</code> 主从模式下可以确保数据同步的一致性（主从切换时）。</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-63-1">gtid-mode<span class="o">=</span>on<span class="w"> </span>
</span><span id="__span-63-2">enforce-gtid-consistency<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="c1"># 设置为主从强一致性 </span>
</span><span id="__span-63-3">log-slave-updates<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="c1"># 记录日志</span>
</span></code></pre></div></td></tr></table></div>
<p><code>GTID</code> 是 <code>MySQL</code> 复制增强版，从 <code>MySQL 5.6</code> 版本开始支持，目前已经是 <code>MySQL</code> 主流复制模式。它为每个 <code>event</code> 分配一个全局唯一 <code>ID</code> 和序号，我们可以不用关心 <code>MySQL</code> 集群主从拓扑结构，直接告知 <code>MySQL</code> 这个 <code>GTID</code> 即可</p>
</li>
<li>
<p>重启 <code>MySQL</code></p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-64-1">sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>mysqld
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="722-mysql">7.2.2 准备 MySQL 表和数据<a class="headerlink" href="#722-mysql" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>在 <code>MySQL</code> 中创建数据表并写入数据</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-65-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">testck</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-65-2"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">testck</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">t_organization</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-65-3"><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-65-4"><span class="w">    </span><span class="o">`</span><span class="n">code</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-65-5"><span class="w">    </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-65-6"><span class="w">    </span><span class="o">`</span><span class="n">updatetime</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-65-7"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-65-8"><span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">code</span><span class="o">`</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-65-9"><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-65-10"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">testck</span><span class="p">.</span><span class="n">t_organization</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="n">updatetime</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39;Realinsight&#39;</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span><span class="w"> </span>
</span><span id="__span-65-11"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">testck</span><span class="p">.</span><span class="n">t_organization</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="n">updatetime</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Realindex&#39;</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span><span class="w"> </span>
</span><span id="__span-65-12"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">testck</span><span class="p">.</span><span class="n">t_organization</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="n">updatetime</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1002</span><span class="p">,</span><span class="s1">&#39;EDT&#39;</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>创建第二张表</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-66-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">testck</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">t_user</span><span class="o">`</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-66-2"><span class="w">    </span><span class="o">`</span><span class="w"> </span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-66-3"><span class="w">    </span><span class="o">`</span><span class="n">code</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-66-4"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-66-5"><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-66-6"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">testck</span><span class="p">.</span><span class="n">t_user</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="723-clickhouse">7.2.3 开启 ClickHouse 物化引擎<a class="headerlink" href="#723-clickhouse" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-67-1"><span class="k">set</span><span class="w"> </span><span class="n">allow_experimental_database_materialize_mysql</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="724">7.2.4 创建复制管道<a class="headerlink" href="#724" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><code>ClickHouse</code> 中创建 <code>MaterializeMySQL</code> 数据库</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-68-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">test_binlog</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterializeMySQL</span><span class="p">(</span><span class="s1">&#39;hadoop1:3306&#39;</span><span class="p">,</span><span class="s1">&#39;testck&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;000000&#39;</span><span class="p">);</span>
</span></code></pre></div></td></tr></table></div>
<p>其中 <code>4</code> 个参数分别是 <code>MySQL</code> 地址、 <code>databse</code> 、 <code>username</code> 和 <code>password</code> 。</p>
</li>
<li>
<p>查看 <code>ClickHouse</code> 的数据</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-69-1"><span class="n">use</span><span class="w"> </span><span class="n">test_binlog</span><span class="p">;</span>
</span><span id="__span-69-2"><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span>
</span><span id="__span-69-3"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_organization</span><span class="p">;</span>
</span><span id="__span-69-4"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_user</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="725">7.2.5 修改数据<a class="headerlink" href="#725" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>在 <code>MySQL</code> 中修改数据：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-70-1"><span class="k">update</span><span class="w"> </span><span class="n">t_organization</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;-v1&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>查看 <code>clickhouse</code> 日志可以看到 <code>binlog</code> 监听事件，查询 <code>clickhouse</code></p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-71-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_organization</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="726">7.2.6 删除数据<a class="headerlink" href="#726" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><code>MySQL</code> 删除数据：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-72-1"><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_organization</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p><code>ClicKHouse</code> ，日志有 <code>DeleteRows</code> 的 <code>binlog</code> 监听事件，查看数据：</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-73-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_organization</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在刚才的查询中增加 <code>_sign</code> <code>和_version</code> 虚拟字段</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-74-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="n">_sign</span><span class="p">,</span><span class="n">_version</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_organization</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">_sign</span><span class="w"> </span><span class="k">desc</span><span class="p">,</span><span class="n">_version</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p><img alt="" src="../../../../assets/images/ClickHouse/ClickHouse%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/ClickHouse%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-%E9%AB%98%E7%BA%A7_image_3.png" /></p>
<p>在查询时，对于已经被删除的数据， <code>_sign=-1</code> ， <code>ClickHouse</code> 会自动重写 <code>SQL</code> ，将 <code>_sign = -1</code> 的数据过滤掉；</p>
<p>对于修改的数据，则自动重写 <code>SQL</code> ，为其增加 <code>FINAL</code> 修饰符。</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-75-1"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_organization</span><span class="w"> </span>
</span><span id="__span-75-2"><span class="o">#</span><span class="err">等同于</span><span class="w"> </span>
</span><span id="__span-75-3"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_organization</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">_sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h4 id="727">7.2.7 删除表<a class="headerlink" href="#727" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>在 <code>mysql</code> 执行删除表</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-76-1"><span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t_user</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>此时在 <code>clickhouse</code> 处会同步删除对应表，如果查询会报错</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-77-1"><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-77-2"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_user</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-77-3"><span class="n">DB</span><span class="p">::</span><span class="k">Exception</span><span class="p">:</span><span class="w"> </span><span class="k">Table</span><span class="w"> </span><span class="n">scene_mms</span><span class="p">.</span><span class="n">scene</span><span class="w"> </span><span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">exist</span><span class="p">..</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p><code>mysql</code> 新建表， <code>clickhouse</code> 可以查询到</p>
<div class="language-sql highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-78-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">testck</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">t_user</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-78-2"><span class="w">    </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w"> </span><span class="o">`</span>
</span><span id="__span-78-3"><span class="w">    </span><span class="n">code</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-78-4"><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-78-5"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">testck</span><span class="p">.</span><span class="n">t_user</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-78-6"><span class="o">#</span><span class="n">ClickHouse</span><span class="w"> </span><span class="err">查询</span><span class="w"> </span>
</span><span id="__span-78-7"><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_user</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h2 id="8">8 常见问题排查<a class="headerlink" href="#8" title="Permanent link">&para;</a></h2>
<h3 id="81-ddl">8.1 分布式 DDL 某数据节点的副本不执行<a class="headerlink" href="#81-ddl" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>问题：</p>
<p>使用分布式 <code>ddl</code> 执行命令 <code>create table on cluster xxxx</code> 某个节点上没有创建表，但是 <code>client</code> 返回正常，查看日志有如下报错。</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-79-1">&lt;Error&gt;xxx.xxx:<span class="w"> </span>Retrying<span class="w"> </span>createReplica<span class="o">()</span>,<span class="w"> </span>because<span class="w"> </span>some<span class="w"> </span>other<span class="w"> </span>replicas<span class="w"> </span>were<span class="w"> </span>created<span class="w"> </span>at<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span><span class="nb">time</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>解决办法：</p>
<p>重启该不执行的节点。</p>
</li>
</ol>
<h3 id="82">8.2 数据副本表和数据不一致<a class="headerlink" href="#82" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>问题：</p>
<p>由于某个数据节点副本异常，导致两数据副本表不一致，某个数据副本缺少表，需要将两个数据副本调整一致。</p>
</li>
<li>
<p>解决办法：</p>
<p>在缺少表的数据副本节点上创建缺少的表，创建为本地表，表结构可以在其他数据副本通过 <code>show create table xxxx</code> 获取。表结构创建后， <code>clickhouse</code> 会自动从其他副本同步该表数据，验证数据量是否一致即可。</p>
</li>
</ol>
<h3 id="83">8.3 副本节点全量恢复<a class="headerlink" href="#83" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>问题：</p>
<p>某个数据副本异常无法启动，需要重新搭建副本。</p>
</li>
<li>
<p>解决办法：</p>
<p>清空异常副本节点的 <code>metadata</code> 和 <code>data</code> 目录。</p>
<p>从另一个正常副本将 <code>metadata</code> 目录拷贝过来（这一步之后可以启动数据库，但是只有表结构没有数据）。</p>
<p>执行 <code>sudo -u clickhouse touch /data/clickhouse/flags/force_restore_data</code> 启动数据库。</p>
</li>
</ol>
<h3 id="84-zk">8.4 数据副本启动缺少 zk 表<a class="headerlink" href="#84-zk" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>问题：</p>
<p>某个数据副本表在 <code>zk</code> 上丢失数据，或者不存在，但是 <code>metadata</code> 元数据里存在，导致启动异常，报错：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-80-1">Can’t<span class="w"> </span>get<span class="w"> </span>data<span class="w"> </span><span class="k">for</span><span class="w"> </span>node<span class="w"> </span>/clickhouse/tables/01-<span class="w"> </span><span class="m">02</span>/xxxxx/xxxxxxx/replicas/xxx/metadata:<span class="w"> </span>node<span class="w"> </span>doesn’t<span class="w"> </span>exist<span class="w"> </span><span class="o">(</span>No<span class="w"> </span>node<span class="o">)</span>:<span class="w"> </span>Cannot<span class="w"> </span>attach<span class="w"> </span>table<span class="w"> </span>xxxxxxx
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>解决办法：</p>
<p><code>metadata</code> 中移除该表的结构文件，如果多个表报错都移除</p>
<p><code>mv metadata/xxxxxx/xxxxxxxx.sql /tmp/</code></p>
<p>启动数据库</p>
<p>手工创建缺少的表，表结构从其他节点 <code>show create table</code> 获取。</p>
<p>创建后会自动同步数据，验证数据是否一致。</p>
</li>
</ol>
<h3 id="85-zk-table-replicas">8.5 ZK table replicas 数据未删除，导致重建表报错<a class="headerlink" href="#85-zk-table-replicas" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>问题：</p>
<p>重建表过程中，先使用 <code>drop table xxx on cluster xxx</code> ，各节点在 <code>clickhouse</code> 上 <code>table</code> 已物理删除，但是 <code>zk</code> 里面针对某个 <code>clickhouse</code> 节点的 <code>table meta</code> 信息未被删除（低概率事件），因 <code>zk</code> 里仍存在该表的 <code>meta</code> 信息，导致再次创建该表 <code>create table xxx on cluster</code> ，该节点无法创建表（其他节点创建表成功），报错：</p>
<p><code>Replica /clickhouse/tables/01-03/xxxxxx/xxx/replicas/xxx already exists..</code></p>
</li>
<li>
<p>解决办法：</p>
<p>从其他数据副本 <code>cp</code> 该 <code>table</code> 的 <code>metadata sql</code> 过来。</p>
<p>重启节点。</p>
</li>
</ol>
<h3 id="86-clickhouse">8.6 Clickhouse 节点意外关闭<a class="headerlink" href="#86-clickhouse" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>问题：</p>
<p>模拟其中一个节点意外宕机，在大量 <code>insert</code> 数据的情况下，关闭某个节点。</p>
</li>
<li>
<p>现象：</p>
<p>数据写入不受影响、数据查询不受影响、建表 <code>DDL</code> 执行到异常节点会卡住，报错：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-81-1">Code:<span class="w"> </span><span class="m">159</span>.<span class="w"> </span>DB::Exception:<span class="w"> </span>Received<span class="w"> </span>from<span class="w"> </span>localhost:9000.<span class="w"> </span>DB::Exception:<span class="w"> </span>Watching<span class="w"> </span>task<span class="w"> </span>/clickhouse/task_queue/ddl/query-0000565925<span class="w"> </span>is<span class="w"> </span>executing<span class="w"> </span>longer<span class="w"> </span>than<span class="w"> </span>distributed_ddl_task_timeout<span class="w"> </span><span class="o">(=</span><span class="m">180</span><span class="o">)</span><span class="w"> </span>seconds.<span class="w"> </span>There<span class="w"> </span>are<span class="w"> </span><span class="m">1</span><span class="w"> </span>unfinished<span class="w"> </span>hosts<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>of<span class="w"> </span>them<span class="w"> </span>are<span class="w"> </span>currently<span class="w"> </span>active<span class="o">)</span>,<span class="w"> </span>they<span class="w"> </span>are<span class="w"> </span>going<span class="w"> </span>to<span class="w"> </span>execute<span class="w"> </span>the<span class="w"> </span>query<span class="w"> </span><span class="k">in</span><span class="w"> </span>background.
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>解决办法：</p>
<p>启动异常节点，期间其他副本写入数据会自动同步过来，其他副本的建表 <code>DDL</code> 也会同步。</p>
</li>
</ol>
<h3 id="87">8.7 其他问题参考<a class="headerlink" href="#87" title="Permanent link">&para;</a></h3>
<p><a href="https://help.aliyun.com/zh/clickhouse/support/faq?spm=a2c4g.11186623.6.652.312e7%209bd17U8IO">https://help.aliyun.com/zh/clickhouse/support/faq?spm=a2c4g.11186623.6.652.312e7%209bd17U8IO</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.instant.preview", "navigation.tracking", "navigation.tabs", "navigation.path", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "navigation.footer", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>